---
title: How to conquer the moutains in Himalaya?
author: Xuxin Zhang
date: '2020-10-01'
slug: how-to-conquer-the-moutains-in-himalaya
categories:
  - R project
tags:
  - data analysis
  - tidymodel
subtitle: ''
summary: ''
authors: []
lastmod: '2020-10-01T18:22:36+08:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
description: "How to climb mountains in Himalaya?"
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p>This week’s data records every attempt people have made to climb the mountains in Himalaya. As an amature hiker, I really hope one day in the future I could step my feet on the groud of Everest which is probably the most famous mountain in Himalaya.</p>
<p>In order to better prepare myself or other climbers (theoretically) for the future climbing, I hope to find out the factors that would have a huge influence on the success rate. After studying different factors in details, a machine learning model would be set up in the final part of this project that could predict my success rate of climbing the mountains in Himalaya.</p>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2>2. Exploratory Data Analysis</h2>
<p>To optimize the success rate, I ask myself the following questions:</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Which mountain(s) has the highest success rate?</li>
<li>Which season should I make my first attempt?</li>
<li>I should be in a group of how many members so that I could have the best success rate?</li>
<li>Would it help me to improve my chance of getting to the peak by hiring more people?</li>
<li>Should I use oxygen when I’m climbing?</li>
<li>The citizens from which country have the higest success rate (so that I can hire them)?</li>
</ol>
</blockquote>
<p>I believe by answering these questions, the chance of success would be improve significantly, and this section would revolve around them.</p>
<div id="success-rate-of-the-top-climbed-mountains" class="section level3">
<h3>2.1 Success rate of the top-climbed mountains</h3>
<p>First, let’s find out the success rate for different mountains.</p>
<pre class="r"><code>library(tidyverse)
theme_set(theme_light())
members &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/members.csv&#39;)
expeditions &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/expeditions.csv&#39;)
peaks &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/peaks.csv&#39;)</code></pre>
<p>After importing the data, let’s first take a look at how many times have the mountains at Himalaya been climbed. Based on this graph, we see that the Everest, Ama Dablam, Cho Oyu, Manaslu, and Lhotse have the highest number of climbing attempts. That is to say the climbing routes of these mountains would be more mature than the others.</p>
<pre class="r"><code>expeditions%&gt;%
  mutate(peak_name = fct_lump_n(peak_name,9))%&gt;%
  filter(!is.na(peak_name))%&gt;%add_count(peak_name)%&gt;%
  ggplot(aes(x = reorder(peak_name,n)))+geom_bar(fill = &quot;lightskyblue3&quot;)+
  geom_text(aes(label = n, y = n), hjust = 1.3)+
  coord_flip()+
  labs(y = &quot;Count&quot;, x = &quot;&quot;,
       title = &quot;The number of attempts of climbing for each mountains&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;)
  )</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Then, we analyze how the number of successful and failing attempts changes over time. From the graph, the general trend is that as time goes on, more and more attempts have been made, so both successful and failing attempts have increased. However, notice the dramatic drop of successful attempts in 2015. After searching related news online, this drop is due to the fact that an earthquake happened near Everest and caused an avalanche. People were afraid of another earthquake, so they restricted their climbing. Details could be found <a href="https://en.wikipedia.org/wiki/2015_Mount_Everest_avalanches">here</a>.</p>
<pre class="r"><code>library(plotly)</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<pre class="r"><code>members%&gt;%
  ggplot(aes(x = as.integer(year),fill = success))+
  geom_histogram(bins = 100)+
  theme(plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;)
  )+
  scale_fill_brewer(palette = &quot;Paired&quot;)+
  labs(x = &quot;Year&quot;, y = &quot;Count&quot;,
       title = &quot;How does the number of successful and failing attempts change?&quot;,
       subtitle = &quot;After searching infomation online,
the plunging number of attempts at 2015 is due to
a huge earthquake happened around Everest&quot;)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The graph above only shows us the big picture, so to secure our chance of making to the top, we need to focus on analyzing specific mountains. Here, in the following graph, we visualize how the number of attempts changes for the mostly climbed mountains.</p>
<pre class="r"><code>library(plotly)
members%&gt;%
  mutate(peak_name = fct_lump_n(peak_name,5))%&gt;%
  filter(!is.na(peak_name))%&gt;%
  ggplot(aes(x = year,fill = success))+
  geom_histogram(bins = 50)+
  labs(x = &quot;Year&quot;, y = &quot;Count&quot;,
       title=&quot;How the climbing attemps changes for the top-climbed  mountains?&quot;)+
  theme(
    
    plot.title = element_text(margin = margin(0,0,10,0),face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  facet_wrap(~peak_name,scales = &quot;free&quot;)+
  scale_fill_brewer(palette = &quot;Paired&quot;)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>However, one should realize that usually the increasing number of successful attempts could be explained by the fact that more people are climbing the mountains. Thus, to leverage out this impact, we calculate the success rate.</p>
<p>After calculating the success rate for these mountains, we find out that even with short-term fluctuations, the success rates of only Cho Oyu, Manaslu and Everest seem to increase over time. The positive correlation is the strongest for Everest, so no wonder Everest is the mostly climbed mountains.</p>
<pre class="r"><code>members%&gt;%
  mutate(peak_name = fct_lump_n(peak_name,5))%&gt;%
  filter(!is.na(peak_name))%&gt;%
  group_by(peak_name,year)%&gt;%
  summarise(success_rate = mean(success==TRUE))%&gt;%
  ggplot(aes(x = year, y = success_rate, group = 1))+
  geom_point(color = &quot;lightskyblue3&quot;)+
  geom_line(color = &quot;lightskyblue3&quot;)+
  labs(x = &quot;Year&quot;, y = &quot;Success Rate&quot;,
       title = &quot;How does the success rate change over time?&quot;,
       subtitle = &quot;Only Cho Oyu, Manaslu and Everest show positive correlation between success rate and year.&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    plot.subtitle = element_text(size = 11),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  facet_wrap(~peak_name,scales = &quot;free&quot;)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;peak_name&#39; (override with `.groups` argument)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="season-and-success-rate" class="section level3">
<h3>2.2 Season and success rate</h3>
<p>This section would focus on this question: which season should one choose to climb the mountains? Intuitively, we would think that one should avoid climbing the mountains in winter. The weather is already freezing enough on the mountains, climbing in winter would only make things worse. But is our intuition true? The following analysis would tell us.</p>
<p>In fact, as the following diagram suggests, you should definitely climb different mountains in specific seasons. Take Everest for example, we see that most of the successful attempts happen in spring. That is to say, if you actually go to Evereset in other seasons, it is highly possible for you not to get to the peak successfully. If you want to climb Ama Dablam, then the favorable seasons would be autumn and winter. With the help of this graph, one should realize the importance of picking the right time to make their attempts.</p>
<pre class="r"><code>expeditions%&gt;%mutate(peak_name = fct_lump_n(peak_name,5))%&gt;%
  filter(peak_name!=&quot;NA&quot;)%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;))%&gt;%
  filter(season!=&quot;Unknown&quot;)%&gt;%
  ggplot(aes( x = status, fill = status))+
  geom_bar()+
  labs(x = &quot;&quot;, y = &quot;Count&quot;,
       title = &quot;The number of attempts for mostly-climbed mountains in different seasons&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;,size = 13),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  scale_fill_brewer(palette = &quot;Paired&quot;)+
  facet_grid(season~peak_name,scales = &quot;free&quot;)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="number-of-members-and-success-rate" class="section level3">
<h3>2.3 Number of members and success rate</h3>
<p>After figuring out which season to go for a climb, the next thing to consider is your group members: how many people should you climb together with?</p>
<p>The graph below shows the distribution of number of group members for the mostly-climbed mountains. As the graph illustrates most of the teams are made up of 6-10 people.</p>
<pre class="r"><code>library(scales)</code></pre>
<pre><code>## 
## Attaching package: &#39;scales&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     discard</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     col_factor</code></pre>
<pre class="r"><code>expeditions%&gt;%select(expedition_id,peak_name,members,member_deaths)%&gt;%
  inner_join(members%&gt;%select(expedition_id,peak_name,success))%&gt;%
  filter(members&gt;0)%&gt;%
  mutate(peak_name = fct_lump_n(peak_name,5))%&gt;%
  filter(!is.na(peak_name))%&gt;%
  group_by(peak_name,members)%&gt;%count(success)%&gt;%
  mutate(success = case_when(success == &quot;TRUE&quot;~&quot;True&quot;,
                             success == &quot;FALSE&quot;~&quot;False&quot;))%&gt;%
  mutate(members = as.factor(case_when(between(members,1,5)~&quot;1-5&quot;,
                             between(members,6,10)~&quot;6-10&quot;,
                             between(members,11,15)~&quot;11-15&quot;,
                             between(members,16,20)~&quot;16-20&quot;,
                             between(members,21,25)~&quot;21-25&quot;,
                             between(members,26,30)~&quot;26-30&quot;,
                             between(members,31,35)~&quot;31-35&quot;,
                             between(members,36,40)~&quot;36-40&quot;,
                             TRUE~&quot;41 and above&quot;)))%&gt;%
  group_by(peak_name,members,success)%&gt;%summarise(n = sum(n))%&gt;%
  ggplot(aes(x = members, y = n, fill = success))+
  geom_histogram(stat = &quot;identity&quot;)+
  labs(x = &quot;Number of members&quot;, y = &quot;Count&quot;,
       title = &quot;Distribution of number of members for the mostly climbed mountains&quot;,
       subtitle = &quot;It turns out 6-10 people in a group is the most popular choice.&quot;)+
  facet_wrap(~peak_name,scales = &quot;free&quot;)+
  theme(axis.text.x = element_text(angle = 90))+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  scale_fill_brewer(palette = &quot;Paired&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;expedition_id&quot;, &quot;peak_name&quot;)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;peak_name&#39;, &#39;members&#39; (override with `.groups` argument)</code></pre>
<pre><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>However, this tells us nothing about the optimal number of members a team should have for each mountains, so we turn to calculate the success rate.</p>
<p>When you first lay your eyes upon this graph, you may quickly notice the spike of success rate for team of 31-35 people and think to yourselves “Wow, I should really get into a group of as many people as possible”. Nontheless, if you go back to the last graph, you will realize that the spike is only due to the fact that there are so few groups of more than 35 members.</p>
<p>In particular, if you want to climb Everest, then a team of 1-5 people should help you to improve your success rate.</p>
<pre class="r"><code>expeditions%&gt;%select(expedition_id,peak_name,members,member_deaths)%&gt;%
  inner_join(members%&gt;%select(expedition_id,peak_name,success))%&gt;%
  filter(members&gt;0)%&gt;%
  mutate(peak_name = fct_lump_n(peak_name,5))%&gt;%
  filter(!is.na(peak_name))%&gt;%
  group_by(peak_name,members)%&gt;%count(success)%&gt;%
  mutate(success = case_when(success == &quot;TRUE&quot;~&quot;True&quot;,
                             success == &quot;FALSE&quot;~&quot;False&quot;))%&gt;%
  mutate(members = as.factor(case_when(between(members,1,5)~&quot;1-5&quot;,
                             between(members,6,10)~&quot;6-10&quot;,
                             between(members,11,15)~&quot;11-15&quot;,
                             between(members,16,20)~&quot;16-20&quot;,
                             between(members,21,25)~&quot;21-25&quot;,
                             between(members,26,30)~&quot;26-30&quot;,
                             between(members,31,35)~&quot;31-35&quot;,
                             between(members,36,40)~&quot;36-40&quot;,
                             TRUE~&quot;41 and above&quot;)))%&gt;%
  group_by(peak_name,members,success)%&gt;%summarise(n = sum(n))%&gt;%
  pivot_wider(names_from = success, values_from = n)%&gt;%
  filter(True&gt;0)%&gt;%
  mutate(success_rate = True/(True+False))%&gt;%
  ggplot(aes(x = members, y = success_rate))+
  geom_bar(stat = &quot;identity&quot;,fill = &quot;skyblue3&quot; )+
  labs(x = &quot;Number of members&quot;, y = &quot;Success rate&quot;,
       title = &quot;Success rate for teams with different number of members&quot;)+
  facet_wrap(~peak_name,scales = &quot;free&quot;)+
  theme(axis.text.x = element_text(angle = 90))+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  scale_fill_brewer(palette = &quot;Paired&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;expedition_id&quot;, &quot;peak_name&quot;)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;peak_name&#39;, &#39;members&#39; (override with `.groups` argument)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>To digress a little bit, let’s examine the relationship between member numbers and the time it takes to climb to the top. I’ve been wondering is it true that the more people I have in my group, the faster we will get to the peak. So I draw the graph below to answer my question. In fact, more people in your group would actually take you more time to reach the peak, suggested by the regression line of a positive gradient.</p>
<pre class="r"><code>expeditions%&gt;%
  filter(peak_name==&quot;Everest&quot;)%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;))%&gt;%
  mutate(total_member = members+hired_staff,
         time = highpoint_date-basecamp_date)%&gt;%
  filter(status==&quot;Success&quot;)%&gt;%
  ggplot(aes(y = time, x = total_member))+
  geom_point( alpha = 0.3)+
  scale_x_log10()+
  geom_smooth()+
  labs(x = &quot;Number of members in a group&quot;,
       y = &quot;Time it takes to get to the peak&quot;,
       title = &quot;The relationship between member numbers and time it takes to get to the top&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;,size = 12))</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type difftime. Defaulting to continuous.</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="ratio-of-hired-members-and-success-rate" class="section level3">
<h3>2.4 Ratio of hired members and success rate</h3>
<p>In this section, we will answer the question “would a higher ratio of hired members in a team increase the success rate?” To answer it, what we need to do is to plot the success rate of the popular mountains against the average ratio of hired members.</p>
<p>To make the result meaningful, we need to first filter out the mountains that are barely climbed.</p>
<pre class="r"><code>common_mounts&lt;-expeditions%&gt;%
  count(peak_name)%&gt;%filter(n&gt;15)

common_mounts</code></pre>
<pre><code>## # A tibble: 48 x 2
##    peak_name           n
##    &lt;chr&gt;           &lt;int&gt;
##  1 Ama Dablam       1366
##  2 Annapurna I       243
##  3 Annapurna II       35
##  4 Annapurna III      36
##  5 Annapurna IV       97
##  6 Annapurna South    36
##  7 Api Main           18
##  8 Baruntse          308
##  9 Bhrikuti           20
## 10 Chamlang           24
## # … with 38 more rows</code></pre>
<p>After filtering out some mountains, here is what we have. With the addition of a regression line, we see that the relationship between success rate and hired ratio is actually in U shape. That is to say, only a relatively high and low hired ratio would contribute to higher success rate. In the case of climbing Everest, based on this graph, maybe you should chose a higher hired ratio to boost your success rate.</p>
<pre class="r"><code>expeditions%&gt;%filter(peak_name%in%common_mounts$peak_name)%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;))%&gt;%
  mutate(total_member = members+hired_staff,
         hired_ratio = hired_staff/total_member)%&gt;%
  group_by(peak_name)%&gt;%summarise(success_rate = mean(status==&quot;Success&quot;,na.rm = TRUE),
                                  hired_ratio = mean(hired_ratio,na.rm = TRUE))%&gt;%
  ggplot(aes(x = hired_ratio, y = success_rate))+
  geom_point()+
  geom_text(aes(label = peak_name),check_overlap = TRUE,vjust = -1)+
  geom_smooth()+
  labs(x = &quot;Hired Ratio&quot;, y = &quot;Success rate&quot;,
       title = &quot;The relationship between hired ratio and success rate&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  scale_fill_brewer(palette = &quot;Paired&quot;)+
  lims(x = c(-0.04,0.43))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="oxygen-usage-and-success-rate" class="section level3">
<h3>2.5 Oxygen usage and success rate</h3>
<p>Last year, I travelled to Tibet in the end of my summer vacation. The average altitude there is about 3000-4000 meters, so my first two days were rather miserable due to the altitude sickness. Whenever I felt uncomfortable, I would inhale some pure oxygen sealed in a bottle. Trust me, oxygen could really save your life at certain point, so I do understand how important oxygen usage could be during the process of climbing the mountains in Himalay. Thus, I envision the success rate of people who used oxygen woudl be higher than those who didn’t, and as the graph below shows, my guess does make sense.</p>
<pre class="r"><code>ggplotly(expeditions%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;))%&gt;%
  filter(peak_name%in%common_mounts$peak_name)%&gt;%
  group_by(year,oxygen_used)%&gt;%summarise(success_rate = mean(status == &quot;Success&quot;))%&gt;%
  ggplot(aes(x = year, y = success_rate, color = oxygen_used))+
  geom_point()+geom_line()+
  labs(x = &quot;Year&quot;, y = &quot;Success rate&quot;,
       title = &quot;The annual success rate in regards of oxygen usage&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.key =  element_rect(fill =&quot;aliceblue&quot;),
    legend.text = element_text(size = 10))+
  scale_color_brewer(palette = &quot;Paired&quot;))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;year&#39; (override with `.groups` argument)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"x":[1905,1910,1920,1921,1925,1929,1930,1931,1933,1934,1935,1936,1937,1940,1947,1949,1950,1951,1952,1953,1954,1955,1957,1958,1959,1960,1961,1962,1963,1964,1965,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.142857142857143,0,0,0,0.307692307692308,0.333333333333333,0.333333333333333,0,0,0.75,0.5,0.6,0.5,0.272727272727273,0.222222222222222,0,0.5,0.6,0.571428571428571,0.235294117647059,0.384615384615385,0.272727272727273,0.352941176470588,0.0909090909090909,0.6,0.25,0.303030303030303,0.473684210526316,0.32,0.419354838709677,0.472727272727273,0.428571428571429,0.464285714285714,0.486111111111111,0.417582417582418,0.314606741573034,0.520408163265306,0.339622641509434,0.476190476190476,0.435114503816794,0.526315789473684,0.548780487804878,0.514285714285714,0.602409638554217,0.532374100719424,0.420289855072464,0.554838709677419,0.446043165467626,0.465408805031447,0.492647058823529,0.530201342281879,0.48125,0.603260869565217,0.466346153846154,0.531496062992126,0.388349514563107,0.423868312757202,0.4921875,0.324324324324324,0.559183673469388,0.406639004149378,0.298165137614679,0.330708661417323,0.168141592920354,0.60126582278481,0.560810810810811,0.612244897959184,0.323529411764706],"text":["year: 1905<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1910<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1920<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1921<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1925<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1929<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1930<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1931<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1933<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1934<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1935<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1936<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1937<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1940<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1947<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1949<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1950<br />success_rate: 0.14285714<br />oxygen_used: FALSE","year: 1951<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1952<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1953<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1954<br />success_rate: 0.30769231<br />oxygen_used: FALSE","year: 1955<br />success_rate: 0.33333333<br />oxygen_used: FALSE","year: 1957<br />success_rate: 0.33333333<br />oxygen_used: FALSE","year: 1958<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1959<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1960<br />success_rate: 0.75000000<br />oxygen_used: FALSE","year: 1961<br />success_rate: 0.50000000<br />oxygen_used: FALSE","year: 1962<br />success_rate: 0.60000000<br />oxygen_used: FALSE","year: 1963<br />success_rate: 0.50000000<br />oxygen_used: FALSE","year: 1964<br />success_rate: 0.27272727<br />oxygen_used: FALSE","year: 1965<br />success_rate: 0.22222222<br />oxygen_used: FALSE","year: 1967<br />success_rate: 0.00000000<br />oxygen_used: FALSE","year: 1968<br />success_rate: 0.50000000<br />oxygen_used: FALSE","year: 1969<br />success_rate: 0.60000000<br />oxygen_used: FALSE","year: 1970<br />success_rate: 0.57142857<br />oxygen_used: FALSE","year: 1971<br />success_rate: 0.23529412<br />oxygen_used: FALSE","year: 1972<br />success_rate: 0.38461538<br />oxygen_used: FALSE","year: 1973<br />success_rate: 0.27272727<br />oxygen_used: FALSE","year: 1974<br />success_rate: 0.35294118<br />oxygen_used: FALSE","year: 1975<br />success_rate: 0.09090909<br />oxygen_used: FALSE","year: 1976<br />success_rate: 0.60000000<br />oxygen_used: FALSE","year: 1977<br />success_rate: 0.25000000<br />oxygen_used: FALSE","year: 1978<br />success_rate: 0.30303030<br />oxygen_used: FALSE","year: 1979<br />success_rate: 0.47368421<br />oxygen_used: FALSE","year: 1980<br />success_rate: 0.32000000<br />oxygen_used: FALSE","year: 1981<br />success_rate: 0.41935484<br />oxygen_used: FALSE","year: 1982<br />success_rate: 0.47272727<br />oxygen_used: FALSE","year: 1983<br />success_rate: 0.42857143<br />oxygen_used: FALSE","year: 1984<br />success_rate: 0.46428571<br />oxygen_used: FALSE","year: 1985<br />success_rate: 0.48611111<br />oxygen_used: FALSE","year: 1986<br />success_rate: 0.41758242<br />oxygen_used: FALSE","year: 1987<br />success_rate: 0.31460674<br />oxygen_used: FALSE","year: 1988<br />success_rate: 0.52040816<br />oxygen_used: FALSE","year: 1989<br />success_rate: 0.33962264<br />oxygen_used: FALSE","year: 1990<br />success_rate: 0.47619048<br />oxygen_used: FALSE","year: 1991<br />success_rate: 0.43511450<br />oxygen_used: FALSE","year: 1992<br />success_rate: 0.52631579<br />oxygen_used: FALSE","year: 1993<br />success_rate: 0.54878049<br />oxygen_used: FALSE","year: 1994<br />success_rate: 0.51428571<br />oxygen_used: FALSE","year: 1995<br />success_rate: 0.60240964<br />oxygen_used: FALSE","year: 1996<br />success_rate: 0.53237410<br />oxygen_used: FALSE","year: 1997<br />success_rate: 0.42028986<br />oxygen_used: FALSE","year: 1998<br />success_rate: 0.55483871<br />oxygen_used: FALSE","year: 1999<br />success_rate: 0.44604317<br />oxygen_used: FALSE","year: 2000<br />success_rate: 0.46540881<br />oxygen_used: FALSE","year: 2001<br />success_rate: 0.49264706<br />oxygen_used: FALSE","year: 2002<br />success_rate: 0.53020134<br />oxygen_used: FALSE","year: 2003<br />success_rate: 0.48125000<br />oxygen_used: FALSE","year: 2004<br />success_rate: 0.60326087<br />oxygen_used: FALSE","year: 2005<br />success_rate: 0.46634615<br />oxygen_used: FALSE","year: 2006<br />success_rate: 0.53149606<br />oxygen_used: FALSE","year: 2007<br />success_rate: 0.38834951<br />oxygen_used: FALSE","year: 2008<br />success_rate: 0.42386831<br />oxygen_used: FALSE","year: 2009<br />success_rate: 0.49218750<br />oxygen_used: FALSE","year: 2010<br />success_rate: 0.32432432<br />oxygen_used: FALSE","year: 2011<br />success_rate: 0.55918367<br />oxygen_used: FALSE","year: 2012<br />success_rate: 0.40663900<br />oxygen_used: FALSE","year: 2013<br />success_rate: 0.29816514<br />oxygen_used: FALSE","year: 2014<br />success_rate: 0.33070866<br />oxygen_used: FALSE","year: 2015<br />success_rate: 0.16814159<br />oxygen_used: FALSE","year: 2016<br />success_rate: 0.60126582<br />oxygen_used: FALSE","year: 2017<br />success_rate: 0.56081081<br />oxygen_used: FALSE","year: 2018<br />success_rate: 0.61224490<br />oxygen_used: FALSE","year: 2019<br />success_rate: 0.32352941<br />oxygen_used: FALSE"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(166,206,227,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(166,206,227,1)"}},"hoveron":"points","name":"FALSE","legendgroup":"FALSE","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.88976377952756,"color":"rgba(166,206,227,1)","dash":"solid"},"frame":null},{"x":[1922,1924,1938,1952,1953,1954,1955,1956,1958,1959,1960,1961,1962,1963,1965,1966,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019],"y":[0,0,0,0,0.333333333333333,0,0.666666666666667,0.75,1,0,0.75,0,0,0.5,0.5,0,0,0.857142857142857,0.4,0.333333333333333,0.666666666666667,0.25,1,0.833333333333333,0.8,0.909090909090909,1,0.692307692307692,0.666666666666667,0.6,0.6,0.625,0.466666666666667,0.230769230769231,0.333333333333333,0.6,0.517241379310345,0.612903225806452,0.5625,0.578947368421053,0.840909090909091,0.6,0.833333333333333,0.702702702702703,0.702127659574468,0.787234042553192,0.767441860465116,0.726027397260274,0.808219178082192,0.841269841269841,0.826086956521739,0.902173913043478,0.737864077669903,0.881481481481482,0.836065573770492,0.831775700934579,0.834645669291339,0.830357142857143,0.836879432624113,0.784172661870504,0.828767123287671,0.827160493827161,0.714285714285714,0.908396946564885,0.8,0.924418604651163,0.906976744186046],"text":["year: 1922<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1924<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1938<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1952<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1953<br />success_rate: 0.33333333<br />oxygen_used:  TRUE","year: 1954<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1955<br />success_rate: 0.66666667<br />oxygen_used:  TRUE","year: 1956<br />success_rate: 0.75000000<br />oxygen_used:  TRUE","year: 1958<br />success_rate: 1.00000000<br />oxygen_used:  TRUE","year: 1959<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1960<br />success_rate: 0.75000000<br />oxygen_used:  TRUE","year: 1961<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1962<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1963<br />success_rate: 0.50000000<br />oxygen_used:  TRUE","year: 1965<br />success_rate: 0.50000000<br />oxygen_used:  TRUE","year: 1966<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1969<br />success_rate: 0.00000000<br />oxygen_used:  TRUE","year: 1970<br />success_rate: 0.85714286<br />oxygen_used:  TRUE","year: 1971<br />success_rate: 0.40000000<br />oxygen_used:  TRUE","year: 1972<br />success_rate: 0.33333333<br />oxygen_used:  TRUE","year: 1973<br />success_rate: 0.66666667<br />oxygen_used:  TRUE","year: 1974<br />success_rate: 0.25000000<br />oxygen_used:  TRUE","year: 1975<br />success_rate: 1.00000000<br />oxygen_used:  TRUE","year: 1976<br />success_rate: 0.83333333<br />oxygen_used:  TRUE","year: 1977<br />success_rate: 0.80000000<br />oxygen_used:  TRUE","year: 1978<br />success_rate: 0.90909091<br />oxygen_used:  TRUE","year: 1979<br />success_rate: 1.00000000<br />oxygen_used:  TRUE","year: 1980<br />success_rate: 0.69230769<br />oxygen_used:  TRUE","year: 1981<br />success_rate: 0.66666667<br />oxygen_used:  TRUE","year: 1982<br />success_rate: 0.60000000<br />oxygen_used:  TRUE","year: 1983<br />success_rate: 0.60000000<br />oxygen_used:  TRUE","year: 1984<br />success_rate: 0.62500000<br />oxygen_used:  TRUE","year: 1985<br />success_rate: 0.46666667<br />oxygen_used:  TRUE","year: 1986<br />success_rate: 0.23076923<br />oxygen_used:  TRUE","year: 1987<br />success_rate: 0.33333333<br />oxygen_used:  TRUE","year: 1988<br />success_rate: 0.60000000<br />oxygen_used:  TRUE","year: 1989<br />success_rate: 0.51724138<br />oxygen_used:  TRUE","year: 1990<br />success_rate: 0.61290323<br />oxygen_used:  TRUE","year: 1991<br />success_rate: 0.56250000<br />oxygen_used:  TRUE","year: 1992<br />success_rate: 0.57894737<br />oxygen_used:  TRUE","year: 1993<br />success_rate: 0.84090909<br />oxygen_used:  TRUE","year: 1994<br />success_rate: 0.60000000<br />oxygen_used:  TRUE","year: 1995<br />success_rate: 0.83333333<br />oxygen_used:  TRUE","year: 1996<br />success_rate: 0.70270270<br />oxygen_used:  TRUE","year: 1997<br />success_rate: 0.70212766<br />oxygen_used:  TRUE","year: 1998<br />success_rate: 0.78723404<br />oxygen_used:  TRUE","year: 1999<br />success_rate: 0.76744186<br />oxygen_used:  TRUE","year: 2000<br />success_rate: 0.72602740<br />oxygen_used:  TRUE","year: 2001<br />success_rate: 0.80821918<br />oxygen_used:  TRUE","year: 2002<br />success_rate: 0.84126984<br />oxygen_used:  TRUE","year: 2003<br />success_rate: 0.82608696<br />oxygen_used:  TRUE","year: 2004<br />success_rate: 0.90217391<br />oxygen_used:  TRUE","year: 2005<br />success_rate: 0.73786408<br />oxygen_used:  TRUE","year: 2006<br />success_rate: 0.88148148<br />oxygen_used:  TRUE","year: 2007<br />success_rate: 0.83606557<br />oxygen_used:  TRUE","year: 2008<br />success_rate: 0.83177570<br />oxygen_used:  TRUE","year: 2009<br />success_rate: 0.83464567<br />oxygen_used:  TRUE","year: 2010<br />success_rate: 0.83035714<br />oxygen_used:  TRUE","year: 2011<br />success_rate: 0.83687943<br />oxygen_used:  TRUE","year: 2012<br />success_rate: 0.78417266<br />oxygen_used:  TRUE","year: 2013<br />success_rate: 0.82876712<br />oxygen_used:  TRUE","year: 2014<br />success_rate: 0.82716049<br />oxygen_used:  TRUE","year: 2015<br />success_rate: 0.71428571<br />oxygen_used:  TRUE","year: 2016<br />success_rate: 0.90839695<br />oxygen_used:  TRUE","year: 2017<br />success_rate: 0.80000000<br />oxygen_used:  TRUE","year: 2018<br />success_rate: 0.92441860<br />oxygen_used:  TRUE","year: 2019<br />success_rate: 0.90697674<br />oxygen_used:  TRUE"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(31,120,180,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(31,120,180,1)"}},"hoveron":"points","name":"TRUE","legendgroup":"TRUE","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.88976377952756,"color":"rgba(31,120,180,1)","dash":"solid"},"frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(240,248,255,1)","paper_bgcolor":"rgba(240,248,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"<b> The annual success rate in regards of oxygen usage <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1899.3,2024.7],"tickmode":"array","ticktext":["1900","1925","1950","1975","2000"],"tickvals":[1900,1925,1950,1975,2000],"categoryorder":"array","categoryarray":["1900","1925","1950","1975","2000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"Year","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"Success rate","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(240,248,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":13.2835201328352},"y":0.913385826771654},"annotations":[{"text":"oxygen_used","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"ea553ea6645":{"x":{},"y":{},"colour":{},"type":"scatter"},"ea541e0670d":{"x":{},"y":{},"colour":{}}},"cur_data":"ea553ea6645","visdat":{"ea553ea6645":["function (y) ","x"],"ea541e0670d":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>The first recorded usage of oxygen happened around 1925, but due to the lag behind of other climbing techinque and techology, there was hardly any difference between the success rate of people using and not using oxygen.</p>
<p>Gradually, as time goes on, the performance of these two groups begins to diverge. After 1986, the climbers who used oxygen have higher success rate than those who did not. Notice that the success rate of people using oxygen in 2019 is 0.90, which means 90% of people who successfully got to the top used oxygen when they were climbing.</p>
<p>Then, we turn to specific mountains to see if the pattern</p>
<pre class="r"><code>expeditions%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;),
         peak_name = fct_lump(peak_name,5))%&gt;%
  filter(peak_name!=&quot;NA&quot;)%&gt;%
  group_by(peak_name,oxygen_used)%&gt;%
  summarise(success_rate = mean(status == &quot;Success&quot;))%&gt;%
  ggplot(aes(x = oxygen_used, y = success_rate, fill = oxygen_used))+
  geom_col()+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))+
  scale_fill_brewer(palette = &quot;Paired&quot;)+
  facet_wrap(~peak_name)</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;peak_name&#39; (override with `.groups` argument)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="citizenship-and-success-rate" class="section level3">
<h3>2.6 Citizenship and success rate</h3>
<pre class="r"><code>top_countries&lt;-peaks%&gt;%filter(!is.na(first_ascent_country), first_ascent_year&gt;1000)%&gt;%
  separate_rows(first_ascent_country,sep = &quot;, &quot;)%&gt;%
  count(first_ascent_country,sort = TRUE)%&gt;%head(10)

peaks%&gt;%filter(!is.na(first_ascent_country), 
               first_ascent_year&gt;1000)%&gt;%
  separate_rows(first_ascent_country,sep = &quot;, &quot;)%&gt;%
  add_count(first_ascent_country,sort = TRUE)%&gt;%
  filter(first_ascent_country%in%top_countries$first_ascent_country)%&gt;%
  mutate(first_ascent_country = reorder(first_ascent_country,n))%&gt;%
  ggplot(aes(x = first_ascent_year, y = first_ascent_country))+
  geom_point(aes(size = height_metres),alpha = 0.3)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.key =  element_rect(fill =&quot;aliceblue&quot;))</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>members_clean&lt;-members%&gt;%select(sex, age, citizenship, expedition_role,success)

top_citizens&lt;-members_clean%&gt;%count(citizenship,sort = TRUE)%&gt;%head(15)

members_clean%&gt;%
  filter(citizenship%in%top_citizens$citizenship)%&gt;%
  group_by(citizenship)%&gt;%
  summarise(success_rate = mean(success == &quot;TRUE&quot;))%&gt;%
  ggplot(aes(x = success_rate, y = reorder(citizenship,success_rate)))+
  geom_point(size = 4, color = &quot;skyblue3&quot;)+
  geom_segment(aes(x = 0, xend = success_rate, y = citizenship, yend = citizenship),
               size = 2.3,
               alpha = 0.5, color = &quot;skyblue3&quot; )+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="other-factors-that-affect-success-rate" class="section level3">
<h3>2.7 Other factors that affect success rate</h3>
<pre class="r"><code>ggplotly(members_clean%&gt;%
  filter(!is.na(sex),
         !is.na(age))%&gt;%
  add_count(sex,age,sort = TRUE)%&gt;%
  filter(n &gt;10)%&gt;%
  group_by(sex,age)%&gt;%
  summarise(success_rate = mean(success == &quot;TRUE&quot;))%&gt;%
  ggplot(aes(x = age, y = success_rate, color = sex))+
  geom_point()+geom_line()+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.key = element_rect(fill =&quot;aliceblue&quot;))+
  scale_color_brewer(palette = &quot;Paired&quot;))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;sex&#39; (override with `.groups` argument)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"data":[{"x":[16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66],"y":[0.5,0.533333333333333,0.545454545454545,0.5,0.5,0.39344262295082,0.317073170731707,0.326732673267327,0.333333333333333,0.306748466257669,0.285714285714286,0.359504132231405,0.296875,0.300380228136882,0.294117647058824,0.35408560311284,0.345588235294118,0.326007326007326,0.347107438016529,0.379061371841155,0.337777777777778,0.294117647058824,0.367441860465116,0.368159203980099,0.345291479820628,0.378378378378378,0.34010152284264,0.33502538071066,0.355555555555556,0.308988764044944,0.371951219512195,0.286624203821656,0.269503546099291,0.318518518518519,0.296551724137931,0.309734513274336,0.383838383838384,0.341463414634146,0.26027397260274,0.333333333333333,0.338461538461538,0.196078431372549,0.210526315789474,0.25,0.195652173913043,0.292682926829268,0.130434782608696,0.52,0.380952380952381,0.137931034482759,0],"text":["age: 16<br />success_rate: 0.5000000<br />sex: F","age: 17<br />success_rate: 0.5333333<br />sex: F","age: 18<br />success_rate: 0.5454545<br />sex: F","age: 19<br />success_rate: 0.5000000<br />sex: F","age: 20<br />success_rate: 0.5000000<br />sex: F","age: 21<br />success_rate: 0.3934426<br />sex: F","age: 22<br />success_rate: 0.3170732<br />sex: F","age: 23<br />success_rate: 0.3267327<br />sex: F","age: 24<br />success_rate: 0.3333333<br />sex: F","age: 25<br />success_rate: 0.3067485<br />sex: F","age: 26<br />success_rate: 0.2857143<br />sex: F","age: 27<br />success_rate: 0.3595041<br />sex: F","age: 28<br />success_rate: 0.2968750<br />sex: F","age: 29<br />success_rate: 0.3003802<br />sex: F","age: 30<br />success_rate: 0.2941176<br />sex: F","age: 31<br />success_rate: 0.3540856<br />sex: F","age: 32<br />success_rate: 0.3455882<br />sex: F","age: 33<br />success_rate: 0.3260073<br />sex: F","age: 34<br />success_rate: 0.3471074<br />sex: F","age: 35<br />success_rate: 0.3790614<br />sex: F","age: 36<br />success_rate: 0.3377778<br />sex: F","age: 37<br />success_rate: 0.2941176<br />sex: F","age: 38<br />success_rate: 0.3674419<br />sex: F","age: 39<br />success_rate: 0.3681592<br />sex: F","age: 40<br />success_rate: 0.3452915<br />sex: F","age: 41<br />success_rate: 0.3783784<br />sex: F","age: 42<br />success_rate: 0.3401015<br />sex: F","age: 43<br />success_rate: 0.3350254<br />sex: F","age: 44<br />success_rate: 0.3555556<br />sex: F","age: 45<br />success_rate: 0.3089888<br />sex: F","age: 46<br />success_rate: 0.3719512<br />sex: F","age: 47<br />success_rate: 0.2866242<br />sex: F","age: 48<br />success_rate: 0.2695035<br />sex: F","age: 49<br />success_rate: 0.3185185<br />sex: F","age: 50<br />success_rate: 0.2965517<br />sex: F","age: 51<br />success_rate: 0.3097345<br />sex: F","age: 52<br />success_rate: 0.3838384<br />sex: F","age: 53<br />success_rate: 0.3414634<br />sex: F","age: 54<br />success_rate: 0.2602740<br />sex: F","age: 55<br />success_rate: 0.3333333<br />sex: F","age: 56<br />success_rate: 0.3384615<br />sex: F","age: 57<br />success_rate: 0.1960784<br />sex: F","age: 58<br />success_rate: 0.2105263<br />sex: F","age: 59<br />success_rate: 0.2500000<br />sex: F","age: 60<br />success_rate: 0.1956522<br />sex: F","age: 61<br />success_rate: 0.2926829<br />sex: F","age: 62<br />success_rate: 0.1304348<br />sex: F","age: 63<br />success_rate: 0.5200000<br />sex: F","age: 64<br />success_rate: 0.3809524<br />sex: F","age: 65<br />success_rate: 0.1379310<br />sex: F","age: 66<br />success_rate: 0.0000000<br />sex: F"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(166,206,227,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(166,206,227,1)"}},"hoveron":"points","name":"F","legendgroup":"F","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.88976377952756,"color":"rgba(166,206,227,1)","dash":"solid"},"frame":null},{"x":[16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76],"y":[0.68,0.509803921568627,0.573643410852713,0.534883720930233,0.516826923076923,0.493939393939394,0.459152016546019,0.447956823438705,0.41820418204182,0.41795154185022,0.402566539923954,0.421518987341772,0.427519379844961,0.407952871870398,0.437290658727205,0.424429841515269,0.407846039970392,0.419538053767512,0.386996904024768,0.418174342105263,0.403330625507717,0.38752688172043,0.413082437275986,0.396085740913327,0.407539480387163,0.392762107503991,0.397622906537007,0.369177688326625,0.377487562189055,0.36869340232859,0.383345836459115,0.374800637958533,0.344234079173838,0.341417910447761,0.33923578751165,0.308558558558559,0.307514450867052,0.300370828182942,0.316023738872404,0.289230769230769,0.290441176470588,0.291028446389497,0.255980861244019,0.246341463414634,0.257617728531856,0.224683544303797,0.220973782771536,0.221739130434783,0.15979381443299,0.220858895705521,0.171875,0.18018018018018,0.168421052631579,0.246153846153846,0.2,0.260869565217391,0.210526315789474,0.12,0.1,0.333333333333333,0.272727272727273],"text":["age: 16<br />success_rate: 0.6800000<br />sex: M","age: 17<br />success_rate: 0.5098039<br />sex: M","age: 18<br />success_rate: 0.5736434<br />sex: M","age: 19<br />success_rate: 0.5348837<br />sex: M","age: 20<br />success_rate: 0.5168269<br />sex: M","age: 21<br />success_rate: 0.4939394<br />sex: M","age: 22<br />success_rate: 0.4591520<br />sex: M","age: 23<br />success_rate: 0.4479568<br />sex: M","age: 24<br />success_rate: 0.4182042<br />sex: M","age: 25<br />success_rate: 0.4179515<br />sex: M","age: 26<br />success_rate: 0.4025665<br />sex: M","age: 27<br />success_rate: 0.4215190<br />sex: M","age: 28<br />success_rate: 0.4275194<br />sex: M","age: 29<br />success_rate: 0.4079529<br />sex: M","age: 30<br />success_rate: 0.4372907<br />sex: M","age: 31<br />success_rate: 0.4244298<br />sex: M","age: 32<br />success_rate: 0.4078460<br />sex: M","age: 33<br />success_rate: 0.4195381<br />sex: M","age: 34<br />success_rate: 0.3869969<br />sex: M","age: 35<br />success_rate: 0.4181743<br />sex: M","age: 36<br />success_rate: 0.4033306<br />sex: M","age: 37<br />success_rate: 0.3875269<br />sex: M","age: 38<br />success_rate: 0.4130824<br />sex: M","age: 39<br />success_rate: 0.3960857<br />sex: M","age: 40<br />success_rate: 0.4075395<br />sex: M","age: 41<br />success_rate: 0.3927621<br />sex: M","age: 42<br />success_rate: 0.3976229<br />sex: M","age: 43<br />success_rate: 0.3691777<br />sex: M","age: 44<br />success_rate: 0.3774876<br />sex: M","age: 45<br />success_rate: 0.3686934<br />sex: M","age: 46<br />success_rate: 0.3833458<br />sex: M","age: 47<br />success_rate: 0.3748006<br />sex: M","age: 48<br />success_rate: 0.3442341<br />sex: M","age: 49<br />success_rate: 0.3414179<br />sex: M","age: 50<br />success_rate: 0.3392358<br />sex: M","age: 51<br />success_rate: 0.3085586<br />sex: M","age: 52<br />success_rate: 0.3075145<br />sex: M","age: 53<br />success_rate: 0.3003708<br />sex: M","age: 54<br />success_rate: 0.3160237<br />sex: M","age: 55<br />success_rate: 0.2892308<br />sex: M","age: 56<br />success_rate: 0.2904412<br />sex: M","age: 57<br />success_rate: 0.2910284<br />sex: M","age: 58<br />success_rate: 0.2559809<br />sex: M","age: 59<br />success_rate: 0.2463415<br />sex: M","age: 60<br />success_rate: 0.2576177<br />sex: M","age: 61<br />success_rate: 0.2246835<br />sex: M","age: 62<br />success_rate: 0.2209738<br />sex: M","age: 63<br />success_rate: 0.2217391<br />sex: M","age: 64<br />success_rate: 0.1597938<br />sex: M","age: 65<br />success_rate: 0.2208589<br />sex: M","age: 66<br />success_rate: 0.1718750<br />sex: M","age: 67<br />success_rate: 0.1801802<br />sex: M","age: 68<br />success_rate: 0.1684211<br />sex: M","age: 69<br />success_rate: 0.2461538<br />sex: M","age: 70<br />success_rate: 0.2000000<br />sex: M","age: 71<br />success_rate: 0.2608696<br />sex: M","age: 72<br />success_rate: 0.2105263<br />sex: M","age: 73<br />success_rate: 0.1200000<br />sex: M","age: 74<br />success_rate: 0.1000000<br />sex: M","age: 75<br />success_rate: 0.3333333<br />sex: M","age: 76<br />success_rate: 0.2727273<br />sex: M"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(31,120,180,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(31,120,180,1)"}},"hoveron":"points","name":"M","legendgroup":"M","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.88976377952756,"color":"rgba(31,120,180,1)","dash":"solid"},"frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(240,248,255,1)","paper_bgcolor":"rgba(240,248,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[13,79],"tickmode":"array","ticktext":["20","40","60"],"tickvals":[20,40,60],"categoryorder":"array","categoryarray":["20","40","60"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"age","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.034,0.714],"tickmode":"array","ticktext":["0.0","0.2","0.4","0.6"],"tickvals":[0,0.2,0.4,0.6],"categoryorder":"array","categoryarray":["0.0","0.2","0.4","0.6"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"success_rate","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(240,248,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.913385826771654},"annotations":[{"text":"sex","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"ea5799f59bf":{"x":{},"y":{},"colour":{},"type":"scatter"},"ea54cbd48fa":{"x":{},"y":{},"colour":{}}},"cur_data":"ea5799f59bf","visdat":{"ea5799f59bf":["function (y) ","x"],"ea54cbd48fa":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>members_clean%&gt;%
  filter(!is.na(expedition_role))%&gt;%
  mutate(expedition_role = fct_lump_n(expedition_role,9))%&gt;%
  group_by(expedition_role)%&gt;%
  summarise(success_rate = mean(success == &quot;TRUE&quot;))%&gt;%
  ggplot(aes(x = success_rate, y = reorder(expedition_role,success_rate)))+
  geom_point(size = 4, color = &quot;skyblue3&quot;)+
  geom_segment(aes(x = 0, xend = success_rate, y = expedition_role, yend = expedition_role),
               size = 2.3,
               alpha = 0.5, color = &quot;skyblue3&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="death-and-injury" class="section level2">
<h2>3. Death and injury</h2>
<pre class="r"><code>expeditions%&gt;%
  filter(peak_name==&quot;Everest&quot;)%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;))%&gt;%
  filter(status==&quot;Failed&quot;)%&gt;%
  mutate(total_death = member_deaths+hired_staff_deaths,
         time = highpoint_date-basecamp_date)%&gt;%
  ggplot(aes(x = time, y = highpoint_metres))+
  geom_point(aes(size = total_death), alpha = 0.4)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.key = element_rect(fill =&quot;aliceblue&quot;) )</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type difftime. Defaulting to continuous.</code></pre>
<pre><code>## Warning: Removed 95 rows containing missing values (geom_point).</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>expeditions%&gt;%
  filter(peak_name==&quot;Everest&quot;)%&gt;%
  mutate(status = case_when(str_detect(termination_reason, &quot;Success&quot;)~&quot;Success&quot;,
                                        TRUE~&quot;Failed&quot;))%&gt;%
  mutate(total_death = member_deaths+hired_staff_deaths,
         time = highpoint_date-basecamp_date)%&gt;%
  filter(status==&quot;Failed&quot;, total_death!=0)%&gt;%
  ggplot(aes(x = time, y = highpoint_metres))+
  geom_point(aes(size = total_death), alpha = 0.4)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.background = element_rect(fill =&quot;aliceblue&quot;),
    legend.key = element_rect(fill =&quot;aliceblue&quot;) )</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type difftime. Defaulting to continuous.</code></pre>
<pre><code>## Warning: Removed 9 rows containing missing values (geom_point).</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>members%&gt;%filter(peak_name==&quot;Everest&quot;)%&gt;%
  ggplot(aes(x= injury_height_metres))+
  geom_histogram(fill = &quot;lightskyblue3&quot;, color = &quot;white&quot;)+
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank(),
    panel.background = element_rect(fill =  &quot;aliceblue&quot;),
    plot.background = element_rect(fill =&quot;aliceblue&quot;)
  )</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 21511 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="/post/Himalaya/index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
