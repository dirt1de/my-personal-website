---
title: Data analysis on "Friends"
author: Xuxin Zhang
date: '2020-09-16'
slug: data-analysis-on-friends
categories:
  - R project
tags:
  - text mining
  - tidymodel
  - sentiment analysis
  - data visualization
subtitle: ''
summary: ''
authors: []
lastmod: '2020-09-16T16:06:34+08:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p>In this project, we will focus on probably the most world-renowned TV series “Friends”. This project would be divided into two parts. The first part is the general analysis on the data we have. It could be further broken down into three subcategories: season analysis, episode analysis, and character analysis. We will create a lasso regression model using <code>tidymodels</code> package to predict the IMDb rating for episodes in the second part. What we are going to do in the second part is quite similar to what we have done in the “Office” post, so also check that out if you are interested.</p>
<p><img src="/media/friends.jpg" /></p>
</div>
<div id="preliminary-data-analysis" class="section level2">
<h2>2. Preliminary data analysis</h2>
<p>First of all, we need to load the packages we are going to use later and import the friends data.</p>
<pre class="r"><code>library(tidyverse)
library(tidymodels)
library(plotly)
library(stringr)
library(tidylo)
library(tidytext)

theme_set(theme_classic())
friends &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-08/friends.csv&#39;)
friends_emotions &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-08/friends_emotions.csv&#39;)
friends_info &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-08/friends_info.csv&#39;)</code></pre>
<p>We can take a look at each of them to see what kinds of data are included.</p>
<p>We see that the <code>friends</code> data contains the lines spoken by each character in each episodes; <code>friends_info</code> has the data about the directors and writers, count for US viewers, and the IMDb rating for each episodes; in <code>friends_emotions</code>, we can find the category of emotion related to each utterance.</p>
<pre class="r"><code>friends%&gt;%head()</code></pre>
<pre><code>## # A tibble: 6 x 6
##   text                                 speaker    season episode scene utterance
##   &lt;chr&gt;                                &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 There&#39;s nothing to tell! He&#39;s just … Monica Ge…      1       1     1         1
## 2 C&#39;mon, you&#39;re going out with the gu… Joey Trib…      1       1     1         2
## 3 All right Joey, be nice. So does he… Chandler …      1       1     1         3
## 4 Wait, does he eat chalk?             Phoebe Bu…      1       1     1         4
## 5 (They all stare, bemused.)           Scene Dir…      1       1     1         5
## 6 Just, &#39;cause, I don&#39;t want her to g… Phoebe Bu…      1       1     1         6</code></pre>
<pre class="r"><code>friends_info%&gt;%head()</code></pre>
<pre><code>## # A tibble: 6 x 8
##   season episode title directed_by written_by air_date   us_views_millio…
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;date&gt;                &lt;dbl&gt;
## 1      1       1 The … James Burr… David Cra… 1994-09-22             21.5
## 2      1       2 The … James Burr… David Cra… 1994-09-29             20.2
## 3      1       3 The … James Burr… Jeffrey A… 1994-10-06             19.5
## 4      1       4 The … James Burr… Alexa Jun… 1994-10-13             19.7
## 5      1       5 The … Pamela Fry… Jeff Gree… 1994-10-20             18.6
## 6      1       6 The … Arlene San… Adam Chas… 1994-10-27             18.2
## # … with 1 more variable: imdb_rating &lt;dbl&gt;</code></pre>
<pre class="r"><code>friends_emotions%&gt;%head()</code></pre>
<pre><code>## # A tibble: 6 x 5
##   season episode scene utterance emotion
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  
## 1      1       1     4         1 Mad    
## 2      1       1     4         3 Neutral
## 3      1       1     4         4 Joyful 
## 4      1       1     4         5 Neutral
## 5      1       1     4         6 Neutral
## 6      1       1     4         7 Neutral</code></pre>
<div id="season-analysis" class="section level3">
<h3>2.1 Season analysis</h3>
<p>As said in the introduction, we will first do a season analysis. In specific, we will analyze the distribution fo IMDb rating for each of the 10 seasons.</p>
<p>With the help of the regression line, we find the pattern for the IMDb rating is that the rating reaches the peak around Season 5, then the rating declines and reaches bottom at Season 8. The rating finally climbs back to the top at the last season. In addition, we can see that IMDb rating varies the most at Season 4: it has both the lowest rating of 7.2 as well as the second highest rating of 9.5.</p>
<pre class="r"><code>ggplotly(friends_info%&gt;%mutate(season = as.factor(season))%&gt;%
  ggplot(aes(y  = imdb_rating, x = season,fill = season))+
  geom_boxplot(alpha  = 0.3,show.legend = FALSE)+
  geom_smooth(aes(group = 1), se = FALSE)+theme(legend.position = &quot;null&quot;)+
  labs(x = &quot;Season&quot;, y = &quot;IMDb rating&quot;,
       title =&quot;IMDb rating distribution for each season&quot;))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: `group_by_()` is deprecated as of dplyr 0.7.0.
## Please use `group_by()` instead.
## See vignette(&#39;programming&#39;) for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[8.3,8.1,8.2,8.1,8.5,8.1,9,8.1,8.2,8.1,8.2,8.2,8.7,8.3,8.2,8.2,8.5,8.8,8.1,7.9,7.9,8.3,8.7,8.9],"hoverinfo":"y","type":"box","fillcolor":"rgba(248,118,109,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[8.5,8.2,8.4,8,8.3,8.6,9,8.5,8,8,8.1,8.6,8.8,9.4,8.9,8.6,8.3,8.5,8.6,8.2,8.2,9,8.1,8.2],"hoverinfo":"y","type":"box","fillcolor":"rgba(216,144,0,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"y":[8.4,9,8.1,8.1,8.1,9.1,8.3,8.4,9,8.1,8.6,8.2,8.2,7.9,8.6,9.1,8.3,8.4,8.2,8.1,8.7,8.3,8.1,8.1,8.8],"hoverinfo":"y","type":"box","fillcolor":"rgba(163,165,0,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],"y":[9.1,8.1,8.5,8.2,8.4,8.5,8.7,9.1,7.9,8.1,8.5,9.5,8.2,8.2,8.5,8.2,8.6,8.3,8.7,8.5,7.2,8.5,8.7,9.2],"hoverinfo":"y","type":"box","fillcolor":"rgba(57,182,0,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],"y":[8.9,9,8.8,8.3,8.8,8.1,8.4,9.2,9.1,8.2,9.1,8.3,8.1,9.7,8.5,8.6,8.5,8,8.7,8.3,8.5,8.3,8.8,9.1],"hoverinfo":"y","type":"box","fillcolor":"rgba(0,191,125,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],"y":[8.7,8.2,8.2,8.5,8.2,8.5,8.4,8.5,9.2,8.6,8.1,8.1,8.2,8.6,8.5,8.5,9.1,8.3,8.3,7.4,8.6,9,8.6,8.8,9.3],"hoverinfo":"y","type":"box","fillcolor":"rgba(0,191,196,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"6","legendgroup":"6","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],"y":[8.4,8.3,8.1,8.1,8.1,8.9,8.5,8.2,8.1,8.5,8.6,8.7,8.4,8.6,8.4,8.7,8.4,8.4,8.7,8.4,7.5,8.4,8.9,9.2],"hoverinfo":"y","type":"box","fillcolor":"rgba(0,176,246,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"7","legendgroup":"7","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],"y":[8.7,9.1,8.7,9.3,8.1,8.5,7.9,8.8,9.3,8.1,8,8.6,8.6,8.2,8.4,8.3,8.1,8.2,7.5,8.2,8.2,8.3,8.8,8.9],"hoverinfo":"y","type":"box","fillcolor":"rgba(149,144,255,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"8","legendgroup":"8","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],"y":[8.6,8.6,8.2,8.2,8.5,8.4,8.7,8.8,8.2,7.5,8,8,8.2,8.2,8.3,8.2,8.5,8.6,8.1,8.3,8.2,7.8,8.5,8.7],"hoverinfo":"y","type":"box","fillcolor":"rgba(231,107,243,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"9","legendgroup":"9","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],"y":[8.5,8.8,8.8,8.3,8.2,8.2,8.3,8.9,8.6,8,9,8.9,8.5,8.6,8.5,8.9,9.7,9.7],"hoverinfo":"y","type":"box","fillcolor":"rgba(255,98,188,0.3)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"},"size":5.66929133858268},"line":{"color":"rgba(51,51,51,1)","width":1.88976377952756},"name":"10","legendgroup":"10","showlegend":true,"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[8.3296643248628,8.40519271592004,8.46928672457763,8.51494756962161,8.54185421907808,8.53341466160187,8.4497966034913,8.41232930009257,8.46154024149123,8.58764849885479],"text":["season:  1<br />imdb_rating: 8.329664<br />season: grey60","season:  2<br />imdb_rating: 8.405193<br />season: grey60","season:  3<br />imdb_rating: 8.469287<br />season: grey60","season:  4<br />imdb_rating: 8.514948<br />season: grey60","season:  5<br />imdb_rating: 8.541854<br />season: grey60","season:  6<br />imdb_rating: 8.533415<br />season: grey60","season:  7<br />imdb_rating: 8.449797<br />season: grey60","season:  8<br />imdb_rating: 8.412329<br />season: grey60","season:  9<br />imdb_rating: 8.461540<br />season: grey60","season: 10<br />imdb_rating: 8.587648<br />season: grey60"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.77952755905512,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":31.4155251141553},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"IMDb rating distribution for each season","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,10.6],"tickmode":"array","ticktext":["1","2","3","4","5","6","7","8","9","10"],"tickvals":[1,2,3,4,5,6,7,8,9,10],"categoryorder":"array","categoryarray":["1","2","3","4","5","6","7","8","9","10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"Season","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[7.075,9.825],"tickmode":"array","ticktext":["8","9"],"tickvals":[8,9],"categoryorder":"array","categoryarray":["8","9"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"IMDb rating","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.913385826771654},"annotations":[{"text":"season","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"126266f37b7c":{"x":{},"y":{},"fill":{},"type":"box"},"12627b303eb1":{"x":{},"y":{},"fill":{}}},"cur_data":"126266f37b7c","visdat":{"126266f37b7c":["function (y) ","x"],"12627b303eb1":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="episode-analysis" class="section level3">
<h3>2.2 Episode analysis</h3>
<p>Next we focus on the episodes analysis. In order for the titles of all episodes to fit in the graph, we first need to drop the starting phrases such as “The One with” and “The One Where”.
After doing so, we can visualize the information. The following graph shows the IMDb rating for each of the episodes. It’s not hard to see that “the Prom Video”, “Everybody Finds Out”, “the Embryos”, and “The Last one” have the highest rating. We also notice that “the Invitation”, “Mac and C.H.E.E.S.E.”, “the Vows”, “Christmas” have the lowest ratings.</p>
<pre class="r"><code>remove&lt;-&quot;The One with|The One Where&quot;
title_clean&lt;-stringr::str_remove_all(friends_info$title,remove)

friends_info%&gt;%mutate(epi_num = row_number())%&gt;%
  ggplot(aes(x = epi_num, y = imdb_rating ))+
  geom_point(aes(color = as.factor(season),size = us_views_millions),alpha = 0.6)+
  geom_path(aes(color = as.factor(season)),alpha = 0.6)+
  expand_limits(x = -10)+
  expand_limits(x = 230)+
  geom_text(label = title_clean,hjust = 1,check_overlap = TRUE,size = 2.5)+
  theme(legend.position = &quot;null&quot;)+geom_smooth()+
  labs(x = &quot;Total episode number&quot;, 
       y = &quot;IMDb rating&quot;, 
       title = &quot;The change of IMDb rating across episodes&quot;)+
  scale_color_brewer(palette = &quot;Paired&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>To take a closer look, we can find out the best 15 episodes as well as the worst 15 episodes.</p>
<pre class="r"><code>ggplotly(friends_info%&gt;%distinct(title,imdb_rating,season)%&gt;%
  top_n(15,imdb_rating)%&gt;%
  ggplot(aes(x = imdb_rating,
             y = reorder(title, imdb_rating),
             color = as.factor(season)))+
  geom_point(size = 3)+
  geom_segment(aes(x = 9.0,
                   xend = imdb_rating, 
                   y = title, 
                   yend = title),size = 2, alpha = 0.3)+
    scale_x_continuous(breaks = c(9,9.1,9.2,9.3,9.4,9.5,9.6))+
    labs(x = &quot;IMDb rating&quot;,
         y = &quot;Title&quot;,
         title = &quot;The top 15 episodes with best ratings&quot;,
         color = &quot;seasons&quot;))</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"data":[{"x":[9.4],"y":[17],"text":"imdb_rating: 9.4<br />reorder(title, imdb_rating): The One with the Prom Video<br />as.factor(season): 2","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.1,9.1],"y":[5,7],"text":["imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with the Flashback<br />as.factor(season): 3","imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with the Morning After<br />as.factor(season): 3"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(205,150,0,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(205,150,0,1)"}},"hoveron":"points","name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.1,9.1,9.5,9.2],"y":[6,3,18,13],"text":["imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with the Jellyfish<br />as.factor(season): 4","imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with Chandler in a Box<br />as.factor(season): 4","imdb_rating: 9.5<br />reorder(title, imdb_rating): The One with the Embryos<br />as.factor(season): 4","imdb_rating: 9.2<br />reorder(title, imdb_rating): The One with Ross' Wedding<br />as.factor(season): 4"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(124,174,0,1)"}},"hoveron":"points","name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.2,9.1,9.1,9.7,9.1],"y":[11,4,2,20,1],"text":["imdb_rating: 9.2<br />reorder(title, imdb_rating): The One with All the Thanksgivings<br />as.factor(season): 5","imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with Ross's Sandwich<br />as.factor(season): 5","imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with All the Resolutions<br />as.factor(season): 5","imdb_rating: 9.7<br />reorder(title, imdb_rating): The One Where Everybody Finds Out<br />as.factor(season): 5","imdb_rating: 9.1<br />reorder(title, imdb_rating): The One in Vegas<br />as.factor(season): 5"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,190,103,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,190,103,1)"}},"hoveron":"points","name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.2,9.1,9.3],"y":[10,9,14],"text":["imdb_rating: 9.2<br />reorder(title, imdb_rating): The One Where Ross Got High<br />as.factor(season): 6","imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with Unagi<br />as.factor(season): 6","imdb_rating: 9.3<br />reorder(title, imdb_rating): The One with the Proposal<br />as.factor(season): 6"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"6","legendgroup":"6","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.2],"y":[12],"text":"imdb_rating: 9.2<br />reorder(title, imdb_rating): The One with Monica and Chandler's Wedding<br />as.factor(season): 7","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,169,255,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,169,255,1)"}},"hoveron":"points","name":"7","legendgroup":"7","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.1,9.3,9.3],"y":[8,16,15],"text":["imdb_rating: 9.1<br />reorder(title, imdb_rating): The One with the Red Sweater<br />as.factor(season): 8","imdb_rating: 9.3<br />reorder(title, imdb_rating): The One with the Videotape<br />as.factor(season): 8","imdb_rating: 9.3<br />reorder(title, imdb_rating): The One with the Rumor<br />as.factor(season): 8"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(199,124,255,1)"}},"hoveron":"points","name":"8","legendgroup":"8","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9.7],"y":[19],"text":"imdb_rating: 9.7<br />reorder(title, imdb_rating): The Last One<br />as.factor(season): 10","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(255,97,204,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,97,204,1)"}},"hoveron":"points","name":"10","legendgroup":"10","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.4],"y":[17,17],"text":"x: 9<br />title: The One with the Prom Video<br />imdb_rating: 9.4<br />title: 17<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Prom Video<br />as.factor(season): 2","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(248,118,109,0.3)","dash":"solid"},"hoveron":"points","name":"2","legendgroup":"2","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.1,null,9,9.1],"y":[5,5,null,7,7],"text":["x: 9<br />title: The One with the Flashback<br />imdb_rating: 9.1<br />title:  5<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Flashback<br />as.factor(season): 3","x: 9<br />title: The One with the Flashback<br />imdb_rating: 9.1<br />title:  5<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Flashback<br />as.factor(season): 3",null,"x: 9<br />title: The One with the Morning After<br />imdb_rating: 9.1<br />title:  7<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Morning After<br />as.factor(season): 3","x: 9<br />title: The One with the Morning After<br />imdb_rating: 9.1<br />title:  7<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Morning After<br />as.factor(season): 3"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(205,150,0,0.3)","dash":"solid"},"hoveron":"points","name":"3","legendgroup":"3","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.1,null,9,9.1,null,9,9.5,null,9,9.2],"y":[6,6,null,3,3,null,18,18,null,13,13],"text":["x: 9<br />title: The One with the Jellyfish<br />imdb_rating: 9.1<br />title:  6<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Jellyfish<br />as.factor(season): 4","x: 9<br />title: The One with the Jellyfish<br />imdb_rating: 9.1<br />title:  6<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Jellyfish<br />as.factor(season): 4",null,"x: 9<br />title: The One with Chandler in a Box<br />imdb_rating: 9.1<br />title:  3<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Chandler in a Box<br />as.factor(season): 4","x: 9<br />title: The One with Chandler in a Box<br />imdb_rating: 9.1<br />title:  3<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Chandler in a Box<br />as.factor(season): 4",null,"x: 9<br />title: The One with the Embryos<br />imdb_rating: 9.5<br />title: 18<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Embryos<br />as.factor(season): 4","x: 9<br />title: The One with the Embryos<br />imdb_rating: 9.5<br />title: 18<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Embryos<br />as.factor(season): 4",null,"x: 9<br />title: The One with Ross' Wedding<br />imdb_rating: 9.2<br />title: 13<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Ross' Wedding<br />as.factor(season): 4","x: 9<br />title: The One with Ross' Wedding<br />imdb_rating: 9.2<br />title: 13<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Ross' Wedding<br />as.factor(season): 4"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(124,174,0,0.3)","dash":"solid"},"hoveron":"points","name":"4","legendgroup":"4","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.2,null,9,9.1,null,9,9.1,null,9,9.7,null,9,9.1],"y":[11,11,null,4,4,null,2,2,null,20,20,null,1,1],"text":["x: 9<br />title: The One with All the Thanksgivings<br />imdb_rating: 9.2<br />title: 11<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with All the Thanksgivings<br />as.factor(season): 5","x: 9<br />title: The One with All the Thanksgivings<br />imdb_rating: 9.2<br />title: 11<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with All the Thanksgivings<br />as.factor(season): 5",null,"x: 9<br />title: The One with Ross's Sandwich<br />imdb_rating: 9.1<br />title:  4<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Ross's Sandwich<br />as.factor(season): 5","x: 9<br />title: The One with Ross's Sandwich<br />imdb_rating: 9.1<br />title:  4<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Ross's Sandwich<br />as.factor(season): 5",null,"x: 9<br />title: The One with All the Resolutions<br />imdb_rating: 9.1<br />title:  2<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with All the Resolutions<br />as.factor(season): 5","x: 9<br />title: The One with All the Resolutions<br />imdb_rating: 9.1<br />title:  2<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with All the Resolutions<br />as.factor(season): 5",null,"x: 9<br />title: The One Where Everybody Finds Out<br />imdb_rating: 9.7<br />title: 20<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One Where Everybody Finds Out<br />as.factor(season): 5","x: 9<br />title: The One Where Everybody Finds Out<br />imdb_rating: 9.7<br />title: 20<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One Where Everybody Finds Out<br />as.factor(season): 5",null,"x: 9<br />title: The One in Vegas<br />imdb_rating: 9.1<br />title:  1<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One in Vegas<br />as.factor(season): 5","x: 9<br />title: The One in Vegas<br />imdb_rating: 9.1<br />title:  1<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One in Vegas<br />as.factor(season): 5"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,190,103,0.3)","dash":"solid"},"hoveron":"points","name":"5","legendgroup":"5","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.2,null,9,9.1,null,9,9.3],"y":[10,10,null,9,9,null,14,14],"text":["x: 9<br />title: The One Where Ross Got High<br />imdb_rating: 9.2<br />title: 10<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One Where Ross Got High<br />as.factor(season): 6","x: 9<br />title: The One Where Ross Got High<br />imdb_rating: 9.2<br />title: 10<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One Where Ross Got High<br />as.factor(season): 6",null,"x: 9<br />title: The One with Unagi<br />imdb_rating: 9.1<br />title:  9<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Unagi<br />as.factor(season): 6","x: 9<br />title: The One with Unagi<br />imdb_rating: 9.1<br />title:  9<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Unagi<br />as.factor(season): 6",null,"x: 9<br />title: The One with the Proposal<br />imdb_rating: 9.3<br />title: 14<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Proposal<br />as.factor(season): 6","x: 9<br />title: The One with the Proposal<br />imdb_rating: 9.3<br />title: 14<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Proposal<br />as.factor(season): 6"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,191,196,0.3)","dash":"solid"},"hoveron":"points","name":"6","legendgroup":"6","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.2],"y":[12,12],"text":"x: 9<br />title: The One with Monica and Chandler's Wedding<br />imdb_rating: 9.2<br />title: 12<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with Monica and Chandler's Wedding<br />as.factor(season): 7","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,169,255,0.3)","dash":"solid"},"hoveron":"points","name":"7","legendgroup":"7","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.1,null,9,9.3,null,9,9.3],"y":[8,8,null,16,16,null,15,15],"text":["x: 9<br />title: The One with the Red Sweater<br />imdb_rating: 9.1<br />title:  8<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Red Sweater<br />as.factor(season): 8","x: 9<br />title: The One with the Red Sweater<br />imdb_rating: 9.1<br />title:  8<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Red Sweater<br />as.factor(season): 8",null,"x: 9<br />title: The One with the Videotape<br />imdb_rating: 9.3<br />title: 16<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Videotape<br />as.factor(season): 8","x: 9<br />title: The One with the Videotape<br />imdb_rating: 9.3<br />title: 16<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Videotape<br />as.factor(season): 8",null,"x: 9<br />title: The One with the Rumor<br />imdb_rating: 9.3<br />title: 15<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Rumor<br />as.factor(season): 8","x: 9<br />title: The One with the Rumor<br />imdb_rating: 9.3<br />title: 15<br />imdb_rating: 9<br />reorder(title, imdb_rating): The One with the Rumor<br />as.factor(season): 8"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(199,124,255,0.3)","dash":"solid"},"hoveron":"points","name":"8","legendgroup":"8","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,9.7],"y":[19,19],"text":"x: 9<br />title: The Last One<br />imdb_rating: 9.7<br />title: 19<br />imdb_rating: 9<br />reorder(title, imdb_rating): The Last One<br />as.factor(season): 10","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(255,97,204,0.3)","dash":"solid"},"hoveron":"points","name":"10","legendgroup":"10","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":271.050228310502},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"The top 15 episodes with best ratings","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[8.965,9.735],"tickmode":"array","ticktext":["9.0","9.1","9.2","9.3","9.4","9.5","9.6"],"tickvals":[9,9.1,9.2,9.3,9.4,9.5,9.6],"categoryorder":"array","categoryarray":["9.0","9.1","9.2","9.3","9.4","9.5","9.6"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"IMDb rating","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,20.6],"tickmode":"array","ticktext":["The One in Vegas","The One with All the Resolutions","The One with Chandler in a Box","The One with Ross's Sandwich","The One with the Flashback","The One with the Jellyfish","The One with the Morning After","The One with the Red Sweater","The One with Unagi","The One Where Ross Got High","The One with All the Thanksgivings","The One with Monica and Chandler's Wedding","The One with Ross' Wedding","The One with the Proposal","The One with the Rumor","The One with the Videotape","The One with the Prom Video","The One with the Embryos","The Last One","The One Where Everybody Finds Out"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],"categoryorder":"array","categoryarray":["The One in Vegas","The One with All the Resolutions","The One with Chandler in a Box","The One with Ross's Sandwich","The One with the Flashback","The One with the Jellyfish","The One with the Morning After","The One with the Red Sweater","The One with Unagi","The One Where Ross Got High","The One with All the Thanksgivings","The One with Monica and Chandler's Wedding","The One with Ross' Wedding","The One with the Proposal","The One with the Rumor","The One with the Videotape","The One with the Prom Video","The One with the Embryos","The Last One","The One Where Everybody Finds Out"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"Title","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.913385826771654},"annotations":[{"text":"seasons","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"12624232dad0":{"x":{},"y":{},"colour":{},"type":"scatter"},"126218bbafa4":{"x":{},"y":{},"xend":{},"yend":{},"x.1":{},"y.1":{},"colour":{}}},"cur_data":"12624232dad0","visdat":{"12624232dad0":["function (y) ","x"],"126218bbafa4":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>ggplotly(friends_info%&gt;%distinct(title,imdb_rating,season)%&gt;%
  top_n(-15,imdb_rating)%&gt;%
  ggplot(aes(x = imdb_rating,
             y = reorder(title, imdb_rating),
             color = as.factor(season)))+
  geom_point(size = 3)+
    geom_segment(aes(x = 7, 
                     xend = imdb_rating,
                     y = title, 
                     yend = title),size = 2,alpha = 0.3)+
    scale_x_continuous(breaks = c(7.2,7.4,7.6,7.8,8))+
    labs(x = &quot;IMDb rating&quot;,
         y = &quot;Title&quot;,
         title = &quot;The top 15 episodes with worst ratings&quot;,
         color = &quot;season&quot;))</code></pre>
<div id="htmlwidget-3" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"data":[{"x":[7.9,7.9],"y":[9,10],"text":["imdb_rating: 7.9<br />reorder(title, imdb_rating): The One with the Evil Orthodontist<br />as.factor(season): 1","imdb_rating: 7.9<br />reorder(title, imdb_rating): The One with the Fake Monica<br />as.factor(season): 1"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[8,8,8],"y":[16,15,19],"text":["imdb_rating: 8.0<br />reorder(title, imdb_rating): The One with Phoebe's Husband<br />as.factor(season): 2","imdb_rating: 8.0<br />reorder(title, imdb_rating): The One with Phoebe's Dad<br />as.factor(season): 2","imdb_rating: 8.0<br />reorder(title, imdb_rating): The One with Russ<br />as.factor(season): 2"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(216,144,0,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(216,144,0,1)"}},"hoveron":"points","name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7.9],"y":[8],"text":"imdb_rating: 7.9<br />reorder(title, imdb_rating): The One with Phoebe's Ex-Partner<br />as.factor(season): 3","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(163,165,0,1)"}},"hoveron":"points","name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7.9,7.2],"y":[7,1],"text":["imdb_rating: 7.9<br />reorder(title, imdb_rating): The One Where They're Going to Party!<br />as.factor(season): 4","imdb_rating: 7.2<br />reorder(title, imdb_rating): The One with the Invitation<br />as.factor(season): 4"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(57,182,0,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(57,182,0,1)"}},"hoveron":"points","name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[8],"y":[14],"text":"imdb_rating: 8.0<br />reorder(title, imdb_rating): The One Where Rachel Smokes<br />as.factor(season): 5","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,125,1)"}},"hoveron":"points","name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7.4],"y":[2],"text":"imdb_rating: 7.4<br />reorder(title, imdb_rating): The One with Mac and C.H.E.E.S.E.<br />as.factor(season): 6","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"6","legendgroup":"6","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7.5],"y":[5],"text":"imdb_rating: 7.5<br />reorder(title, imdb_rating): The One with the Vows<br />as.factor(season): 7","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,176,246,1)"}},"hoveron":"points","name":"7","legendgroup":"7","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7.9,8,7.5],"y":[11,18,4],"text":["imdb_rating: 7.9<br />reorder(title, imdb_rating): The One with the Stain<br />as.factor(season): 8","imdb_rating: 8.0<br />reorder(title, imdb_rating): The One with Ross's Step Forward<br />as.factor(season): 8","imdb_rating: 7.5<br />reorder(title, imdb_rating): The One with Joey's Interview<br />as.factor(season): 8"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(149,144,255,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(149,144,255,1)"}},"hoveron":"points","name":"8","legendgroup":"8","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7.5,8,8,7.8],"y":[3,13,17,6],"text":["imdb_rating: 7.5<br />reorder(title, imdb_rating): The One with Christmas in Tulsa<br />as.factor(season): 9","imdb_rating: 8.0<br />reorder(title, imdb_rating): The One Where Rachel Goes Back to Work<br />as.factor(season): 9","imdb_rating: 8.0<br />reorder(title, imdb_rating): The One with Phoebe's Rats<br />as.factor(season): 9","imdb_rating: 7.8<br />reorder(title, imdb_rating): The One with the Donor<br />as.factor(season): 9"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(231,107,243,1)"}},"hoveron":"points","name":"9","legendgroup":"9","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[8],"y":[12],"text":"imdb_rating: 8.0<br />reorder(title, imdb_rating): The One Where Chandler Gets Caught<br />as.factor(season): 10","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(255,98,188,1)","opacity":1,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,98,188,1)"}},"hoveron":"points","name":"10","legendgroup":"10","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.9,null,7,7.9],"y":[9,9,null,10,10],"text":["x: 7<br />title: The One with the Evil Orthodontist<br />imdb_rating: 7.9<br />title:  9<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Evil Orthodontist<br />as.factor(season): 1","x: 7<br />title: The One with the Evil Orthodontist<br />imdb_rating: 7.9<br />title:  9<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Evil Orthodontist<br />as.factor(season): 1",null,"x: 7<br />title: The One with the Fake Monica<br />imdb_rating: 7.9<br />title: 10<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Fake Monica<br />as.factor(season): 1","x: 7<br />title: The One with the Fake Monica<br />imdb_rating: 7.9<br />title: 10<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Fake Monica<br />as.factor(season): 1"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(248,118,109,0.3)","dash":"solid"},"hoveron":"points","name":"1","legendgroup":"1","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,8,null,7,8,null,7,8],"y":[16,16,null,15,15,null,19,19],"text":["x: 7<br />title: The One with Phoebe's Husband<br />imdb_rating: 8.0<br />title: 16<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Husband<br />as.factor(season): 2","x: 7<br />title: The One with Phoebe's Husband<br />imdb_rating: 8.0<br />title: 16<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Husband<br />as.factor(season): 2",null,"x: 7<br />title: The One with Phoebe's Dad<br />imdb_rating: 8.0<br />title: 15<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Dad<br />as.factor(season): 2","x: 7<br />title: The One with Phoebe's Dad<br />imdb_rating: 8.0<br />title: 15<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Dad<br />as.factor(season): 2",null,"x: 7<br />title: The One with Russ<br />imdb_rating: 8.0<br />title: 19<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Russ<br />as.factor(season): 2","x: 7<br />title: The One with Russ<br />imdb_rating: 8.0<br />title: 19<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Russ<br />as.factor(season): 2"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(216,144,0,0.3)","dash":"solid"},"hoveron":"points","name":"2","legendgroup":"2","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.9],"y":[8,8],"text":"x: 7<br />title: The One with Phoebe's Ex-Partner<br />imdb_rating: 7.9<br />title:  8<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Ex-Partner<br />as.factor(season): 3","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(163,165,0,0.3)","dash":"solid"},"hoveron":"points","name":"3","legendgroup":"3","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.9,null,7,7.2],"y":[7,7,null,1,1],"text":["x: 7<br />title: The One Where They're Going to Party!<br />imdb_rating: 7.9<br />title:  7<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One Where They're Going to Party!<br />as.factor(season): 4","x: 7<br />title: The One Where They're Going to Party!<br />imdb_rating: 7.9<br />title:  7<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One Where They're Going to Party!<br />as.factor(season): 4",null,"x: 7<br />title: The One with the Invitation<br />imdb_rating: 7.2<br />title:  1<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Invitation<br />as.factor(season): 4","x: 7<br />title: The One with the Invitation<br />imdb_rating: 7.2<br />title:  1<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Invitation<br />as.factor(season): 4"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(57,182,0,0.3)","dash":"solid"},"hoveron":"points","name":"4","legendgroup":"4","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,8],"y":[14,14],"text":"x: 7<br />title: The One Where Rachel Smokes<br />imdb_rating: 8.0<br />title: 14<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One Where Rachel Smokes<br />as.factor(season): 5","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,191,125,0.3)","dash":"solid"},"hoveron":"points","name":"5","legendgroup":"5","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.4],"y":[2,2],"text":"x: 7<br />title: The One with Mac and C.H.E.E.S.E.<br />imdb_rating: 7.4<br />title:  2<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Mac and C.H.E.E.S.E.<br />as.factor(season): 6","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,191,196,0.3)","dash":"solid"},"hoveron":"points","name":"6","legendgroup":"6","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.5],"y":[5,5],"text":"x: 7<br />title: The One with the Vows<br />imdb_rating: 7.5<br />title:  5<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Vows<br />as.factor(season): 7","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,176,246,0.3)","dash":"solid"},"hoveron":"points","name":"7","legendgroup":"7","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.9,null,7,8,null,7,7.5],"y":[11,11,null,18,18,null,4,4],"text":["x: 7<br />title: The One with the Stain<br />imdb_rating: 7.9<br />title: 11<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Stain<br />as.factor(season): 8","x: 7<br />title: The One with the Stain<br />imdb_rating: 7.9<br />title: 11<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Stain<br />as.factor(season): 8",null,"x: 7<br />title: The One with Ross's Step Forward<br />imdb_rating: 8.0<br />title: 18<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Ross's Step Forward<br />as.factor(season): 8","x: 7<br />title: The One with Ross's Step Forward<br />imdb_rating: 8.0<br />title: 18<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Ross's Step Forward<br />as.factor(season): 8",null,"x: 7<br />title: The One with Joey's Interview<br />imdb_rating: 7.5<br />title:  4<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Joey's Interview<br />as.factor(season): 8","x: 7<br />title: The One with Joey's Interview<br />imdb_rating: 7.5<br />title:  4<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Joey's Interview<br />as.factor(season): 8"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(149,144,255,0.3)","dash":"solid"},"hoveron":"points","name":"8","legendgroup":"8","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,7.5,null,7,8,null,7,8,null,7,7.8],"y":[3,3,null,13,13,null,17,17,null,6,6],"text":["x: 7<br />title: The One with Christmas in Tulsa<br />imdb_rating: 7.5<br />title:  3<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Christmas in Tulsa<br />as.factor(season): 9","x: 7<br />title: The One with Christmas in Tulsa<br />imdb_rating: 7.5<br />title:  3<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Christmas in Tulsa<br />as.factor(season): 9",null,"x: 7<br />title: The One Where Rachel Goes Back to Work<br />imdb_rating: 8.0<br />title: 13<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One Where Rachel Goes Back to Work<br />as.factor(season): 9","x: 7<br />title: The One Where Rachel Goes Back to Work<br />imdb_rating: 8.0<br />title: 13<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One Where Rachel Goes Back to Work<br />as.factor(season): 9",null,"x: 7<br />title: The One with Phoebe's Rats<br />imdb_rating: 8.0<br />title: 17<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Rats<br />as.factor(season): 9","x: 7<br />title: The One with Phoebe's Rats<br />imdb_rating: 8.0<br />title: 17<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with Phoebe's Rats<br />as.factor(season): 9",null,"x: 7<br />title: The One with the Donor<br />imdb_rating: 7.8<br />title:  6<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Donor<br />as.factor(season): 9","x: 7<br />title: The One with the Donor<br />imdb_rating: 7.8<br />title:  6<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One with the Donor<br />as.factor(season): 9"],"type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(231,107,243,0.3)","dash":"solid"},"hoveron":"points","name":"9","legendgroup":"9","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,8],"y":[12,12],"text":"x: 7<br />title: The One Where Chandler Gets Caught<br />imdb_rating: 8.0<br />title: 12<br />imdb_rating: 7<br />reorder(title, imdb_rating): The One Where Chandler Gets Caught<br />as.factor(season): 10","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(255,98,188,0.3)","dash":"solid"},"hoveron":"points","name":"10","legendgroup":"10","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":247.671232876712},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"The top 15 episodes with worst ratings","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[6.95,8.05],"tickmode":"array","ticktext":["7.2","7.4","7.6","7.8","8.0"],"tickvals":[7.2,7.4,7.6,7.8,8],"categoryorder":"array","categoryarray":["7.2","7.4","7.6","7.8","8.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"IMDb rating","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,19.6],"tickmode":"array","ticktext":["The One with the Invitation","The One with Mac and C.H.E.E.S.E.","The One with Christmas in Tulsa","The One with Joey's Interview","The One with the Vows","The One with the Donor","The One Where They're Going to Party!","The One with Phoebe's Ex-Partner","The One with the Evil Orthodontist","The One with the Fake Monica","The One with the Stain","The One Where Chandler Gets Caught","The One Where Rachel Goes Back to Work","The One Where Rachel Smokes","The One with Phoebe's Dad","The One with Phoebe's Husband","The One with Phoebe's Rats","The One with Ross's Step Forward","The One with Russ"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"categoryorder":"array","categoryarray":["The One with the Invitation","The One with Mac and C.H.E.E.S.E.","The One with Christmas in Tulsa","The One with Joey's Interview","The One with the Vows","The One with the Donor","The One Where They're Going to Party!","The One with Phoebe's Ex-Partner","The One with the Evil Orthodontist","The One with the Fake Monica","The One with the Stain","The One Where Chandler Gets Caught","The One Where Rachel Goes Back to Work","The One Where Rachel Smokes","The One with Phoebe's Dad","The One with Phoebe's Husband","The One with Phoebe's Rats","The One with Ross's Step Forward","The One with Russ"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"Title","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.913385826771654},"annotations":[{"text":"season","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"1262756ebde5":{"x":{},"y":{},"colour":{},"type":"scatter"},"12623975419e":{"x":{},"y":{},"xend":{},"yend":{},"x.1":{},"y.1":{},"colour":{}}},"cur_data":"1262756ebde5","visdat":{"1262756ebde5":["function (y) ","x"],"12623975419e":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Since we also have the viewing number at hand, we can ask the question: does the rating depends on the viewing number? To answer it, we can do a regression of rating against the viewing numbers, and here is the result: there is a highly positive correlation between these two variables.</p>
<pre class="r"><code>friends_info%&gt;%
  ggplot(aes(x = us_views_millions, y = imdb_rating))+
  geom_point()+geom_smooth()+
  labs(x = &quot;US views (in millions)&quot;,
       y = &quot;IMDb rating&quot;,
       title = &quot;The relationship between viewing counts and IMDb rating&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Then, we can find out how the sentiment level changes across episodes. To do this, we first need to tokenize all the lines of each episodes and then sum the sentiment value for each word up to get the sentiment level of an episode. Here is what we get: we see that on average, the sentiment level gradually increases across the seasons. From the graph, we notice that “The one with Rachel Has a Baby” has the lowest sentiment level. I don’t remember the content exactly, but the negative sentiment could due to the fact that Rachel and Ross are having a fight in that episode and Rachel complains a lot about the suffer from giving a labor.</p>
<pre class="r"><code>text&lt;-friends_info%&gt;%mutate(epi_num = row_number())%&gt;%
  select(season,episode,title,epi_num)%&gt;%
  right_join(friends, by = c(&quot;season&quot; = &quot;season&quot;, &quot;episode&quot; = &quot;episode&quot;))%&gt;%distinct(season,epi_num,title,text)

text%&gt;%
  unnest_tokens(word,text)%&gt;%
  anti_join(stop_words)%&gt;%inner_join(get_sentiments(&quot;afinn&quot;))%&gt;%
  group_by(season,epi_num,title)%&gt;%
  summarise(sent = sum(value))%&gt;%ungroup()%&gt;%ggplot(aes(x = epi_num, y = sent))+
  geom_point(aes(color = as.factor(season)),alpha = 0.6)+
  geom_line(aes(color = as.factor(season)),alpha = 0.6)+
  geom_text(aes(label = title_clean),check_overlap = TRUE,size = 2.5)+
  geom_smooth()+
  scale_color_brewer(palette = &quot;Paired&quot;)+theme(legend.position = &quot;null&quot;)+
  expand_limits(x = -10)+
  labs(x = &quot;Total episode number&quot;, 
       y = &quot;Sentiment level&quot;,
       title = &quot;The change of sentiment level across episodes&quot;)</code></pre>
<pre><code>## Joining, by = &quot;word&quot;
## Joining, by = &quot;word&quot;</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;season&#39;, &#39;epi_num&#39; (override with `.groups` argument)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="character-analysis" class="section level3">
<h3>2.3 Character analysis</h3>
<p>Now we start our analysis on the characters. Intuitively, we can find out the chracters with the most lines.</p>
<pre class="r"><code>friends%&gt;%count(speaker)%&gt;%
  filter(speaker!=&quot;NA&quot;)%&gt;%
  filter(n&gt;120)%&gt;%arrange(desc(n))%&gt;%
  ggplot(aes(y = reorder(speaker,n), x = n,color = speaker))+
  geom_point(size = 4)+
  geom_segment(aes(x = 40,
                   xend = n, 
                   y = reorder(speaker,n),
                   yend = reorder(speaker,n)),
               size = 3, alpha = 0.2)+
  scale_x_log10()+theme(legend.position = &quot;null&quot;)</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>friends%&gt;%
  select(speaker, text)%&gt;%unnest_tokens(word, text)%&gt;%
  anti_join(stop_words)%&gt;%count(speaker,word)%&gt;%add_count(speaker)%&gt;%
  filter(nn&gt;7000)%&gt;%filter(speaker!=&quot;Scene Directions&quot;)%&gt;%
  add_count(word)%&gt;%
  filter(nnn &gt; 50)%&gt;%
  bind_log_odds(speaker,word,n)%&gt;%
  group_by(speaker)%&gt;%
  top_n(10,log_odds_weighted)%&gt;%
  ggplot(aes(x = log_odds_weighted, 
             y = reorder_within(word, log_odds_weighted, speaker), 
             fill = speaker))+
  geom_col()+facet_wrap(~speaker, scales = &quot;free_y&quot;)+scale_y_reordered()+
  scale_fill_brewer(palette = &quot;Paired&quot;)</code></pre>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<pre><code>## Using `n` as weighting variable
## ℹ Quiet this message with `wt = n` or count rows with `wt = 1`</code></pre>
<pre><code>## Storing counts in `nn`, as `n` already present in input
## ℹ Use `name = &quot;new_name&quot;` to pick a new name.</code></pre>
<pre><code>## Using `n` as weighting variable
## ℹ Quiet this message with `wt = n` or count rows with `wt = 1`</code></pre>
<pre><code>## Storing counts in `nnn`, as `n` already present in input
## ℹ Use `name = &quot;new_name&quot;` to pick a new name.</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>friends%&gt;%select(-text)%&gt;%right_join(friends_emotions)%&gt;%
    count(speaker, emotion)%&gt;%add_count(speaker,name = &quot;num&quot;)%&gt;%
    filter(speaker!=&quot;NA&quot;)%&gt;%
    filter(num&gt;50)%&gt;%
    mutate(average_emo = n/num)%&gt;%
    group_by(emotion)%&gt;%top_n(6,average_emo)%&gt;%
    ggplot(aes(y = reorder_within(speaker,average_emo,emotion), 
               x = average_emo, 
               fill = emotion))+
    geom_col()+
    facet_wrap(~emotion,scales = &quot;free&quot;)+scale_y_reordered()+
    theme(legend.position = &quot;null&quot;)+
    labs(x = &quot;Average emotion level&quot;,
         y = &quot;Characters&quot;,
         title = &quot;Character rankings in different types of emotion&quot;)+
  scale_fill_brewer(palette = &quot;Paired&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;season&quot;, &quot;episode&quot;, &quot;scene&quot;, &quot;utterance&quot;)</code></pre>
<pre><code>## Using `n` as weighting variable
## ℹ Quiet this message with `wt = n` or count rows with `wt = 1`</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>friends_speak&lt;-friends%&gt;%count(speaker,season,episode)%&gt;%
  add_count(speaker,name = &quot;total_speak&quot;)%&gt;%
  add_count(season,episode,name = &quot;total_speak_per_ep&quot;)%&gt;%
  filter(total_speak&gt;7000)%&gt;%select(-total_speak)%&gt;%mutate(prop_line = n/total_speak_per_ep)%&gt;%
  select(-n,-total_speak_per_ep)</code></pre>
<pre><code>## Using `n` as weighting variable
## ℹ Quiet this message with `wt = n` or count rows with `wt = 1`
## Using `n` as weighting variable
## ℹ Quiet this message with `wt = n` or count rows with `wt = 1`</code></pre>
<pre class="r"><code>friends_info%&gt;%select(season,episode,imdb_rating)%&gt;%
  inner_join(friends_speak,by = c(&quot;season&quot;,&quot;episode&quot;))%&gt;%
  ggplot(aes(x = prop_line, y = imdb_rating, color = speaker))+
  geom_point(alpha = 0.5)+facet_wrap(~speaker)+
  scale_x_log10()+
  geom_smooth()+
  scale_color_brewer(palette = &quot;Paired&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
</div>
<div id="constructing-a-lasso-regression-model" class="section level2">
<h2>3. Constructing a lasso regression model</h2>
<pre class="r"><code>friends_actors&lt;-friends%&gt;%
  select(season, episode,speaker)%&gt;%
  count(season, episode,speaker)%&gt;%add_count(speaker)%&gt;%
  filter(nn&gt;=150)%&gt;%
  filter(speaker!=&quot;NA&quot;)%&gt;%
  filter(speaker!=&quot;Scene Directions&quot;)%&gt;%
  select(-nn)%&gt;%
  group_by(season, episode)%&gt;%
  pivot_wider(names_from = speaker, values_from = n, values_fill = 0)</code></pre>
<pre><code>## Using `n` as weighting variable
## ℹ Quiet this message with `wt = n` or count rows with `wt = 1`</code></pre>
<pre><code>## Storing counts in `nn`, as `n` already present in input
## ℹ Use `name = &quot;new_name&quot;` to pick a new name.</code></pre>
<pre class="r"><code>friends_actors</code></pre>
<pre><code>## # A tibble: 236 x 18
## # Groups:   season, episode [236]
##    season episode `#ALL#` `Chandler Bing` `Joey Tribbiani` `Monica Geller`
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;           &lt;int&gt;            &lt;int&gt;           &lt;int&gt;
##  1      1       1       8              39               39              73
##  2      1       2       2              16                8              28
##  3      1       3      21              36               28              52
##  4      1       4       4              32               24              47
##  5      1       5       0              35               36              33
##  6      1       6      14              58               31              34
##  7      1       7       3              25               27              23
##  8      1       8       3              37               11              34
##  9      1       9       1              28               32              48
## 10      1      10       5              31               19              23
## # … with 226 more rows, and 12 more variables: `Phoebe Buffay` &lt;int&gt;, `Rachel
## #   Green` &lt;int&gt;, `Ross Geller` &lt;int&gt;, `Carol Willick` &lt;int&gt;, `Judy
## #   Geller` &lt;int&gt;, `Janice Litman Goralnik` &lt;int&gt;, `Frank Buffay Jr.` &lt;int&gt;,
## #   `Richard Burke` &lt;int&gt;, `Jack Geller` &lt;int&gt;, `Emily Waltham` &lt;int&gt;, `Mike
## #   Hannigan` &lt;int&gt;, `Charlie Wheeler` &lt;int&gt;</code></pre>
<p>Notice the difference in row number. Why is that?
We have filtered out some of the directors and writers.</p>
<pre class="r"><code>friends_creators&lt;-friends_info%&gt;%select(season,
                                        episode, 
                                        directed_by,
                                        written_by,
                                        imdb_rating,
                                        us_views_millions)%&gt;%
  mutate(written_by = str_replace(written_by,&quot;Teleplay by :&quot;,&quot; &amp;&quot;))%&gt;%
  mutate(written_by = str_remove(written_by,&quot;Story by :&quot;))%&gt;%
  separate_rows(written_by,sep =&quot;&amp;&quot;)%&gt;%
  pivot_longer(directed_by:written_by,names_to = &quot;position&quot;,values_to = &quot;name&quot;)%&gt;%
  distinct(season,episode,imdb_rating,position,name,us_views_millions)%&gt;%
  add_count(name)%&gt;%filter(n&gt;=12)%&gt;%
  select(-position,-n)%&gt;%
  mutate(count = 1)%&gt;%group_by(season,episode, imdb_rating)%&gt;%
  pivot_wider(names_from = name, values_from = count, values_fill = 0)

friends_creators</code></pre>
<pre><code>## # A tibble: 182 x 13
## # Groups:   season, episode, imdb_rating [182]
##    season episode imdb_rating us_views_millio… `James Burrows` ` Marta Kauffma…
##     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
##  1      1       1         8.3             21.5               1                1
##  2      1       2         8.1             20.2               1                1
##  3      1       3         8.2             19.5               1                0
##  4      1       4         8.1             19.7               1                0
##  5      1       7         9               23.5               1                0
##  6      1       8         8.1             21.1               1                0
##  7      1       9         8.2             23.1               1                0
##  8      1      10         8.1             19.9               0                0
##  9      1      11         8.2             26.6               1                0
## 10      1      14         8.3             23.8               1                0
## # … with 172 more rows, and 7 more variables: `Peter Bonerz` &lt;dbl&gt;, `Michael
## #   Lembeck` &lt;dbl&gt;, `Gail Mancuso` &lt;dbl&gt;, `Kevin S. Bright` &lt;dbl&gt;, `Gary
## #   Halvorson` &lt;dbl&gt;, ` Ted Cohen` &lt;dbl&gt;, ` Ellen Plummer` &lt;dbl&gt;</code></pre>
<pre class="r"><code>friends_staff&lt;-friends_actors%&gt;%inner_join(friends_creators,by = c(&quot;season&quot;,&quot;episode&quot;))%&gt;%
  inner_join(friends_info%&gt;%select(season,episode, title), by= c(&quot;season&quot;,&quot;episode&quot;))

friends_staff</code></pre>
<pre><code>## # A tibble: 182 x 30
## # Groups:   season, episode [182]
##    season episode `#ALL#` `Chandler Bing` `Joey Tribbiani` `Monica Geller`
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;           &lt;int&gt;            &lt;int&gt;           &lt;int&gt;
##  1      1       1       8              39               39              73
##  2      1       2       2              16                8              28
##  3      1       3      21              36               28              52
##  4      1       4       4              32               24              47
##  5      1       7       3              25               27              23
##  6      1       8       3              37               11              34
##  7      1       9       1              28               32              48
##  8      1      10       5              31               19              23
##  9      1      11       3              42               32              41
## 10      1      14       0              40               21              21
## # … with 172 more rows, and 24 more variables: `Phoebe Buffay` &lt;int&gt;, `Rachel
## #   Green` &lt;int&gt;, `Ross Geller` &lt;int&gt;, `Carol Willick` &lt;int&gt;, `Judy
## #   Geller` &lt;int&gt;, `Janice Litman Goralnik` &lt;int&gt;, `Frank Buffay Jr.` &lt;int&gt;,
## #   `Richard Burke` &lt;int&gt;, `Jack Geller` &lt;int&gt;, `Emily Waltham` &lt;int&gt;, `Mike
## #   Hannigan` &lt;int&gt;, `Charlie Wheeler` &lt;int&gt;, imdb_rating &lt;dbl&gt;,
## #   us_views_millions &lt;dbl&gt;, `James Burrows` &lt;dbl&gt;, ` Marta Kauffman` &lt;dbl&gt;,
## #   `Peter Bonerz` &lt;dbl&gt;, `Michael Lembeck` &lt;dbl&gt;, `Gail Mancuso` &lt;dbl&gt;, `Kevin
## #   S. Bright` &lt;dbl&gt;, `Gary Halvorson` &lt;dbl&gt;, ` Ted Cohen` &lt;dbl&gt;, ` Ellen
## #   Plummer` &lt;dbl&gt;, title &lt;chr&gt;</code></pre>
<pre class="r"><code>set.seed(123)
friends_split&lt;-initial_split(friends_staff,strata = season)
friends_train &lt;- training(friends_split)
friends_test &lt;- testing(friends_split)

friends_boot &lt;- bootstraps(friends_train,strata = season)</code></pre>
<pre class="r"><code>friends_recipe&lt;-recipe(imdb_rating~., data =  friends_train)%&gt;%
  update_role(title, new_role = &quot;ID&quot;)%&gt;%
  step_normalize(all_predictors())%&gt;%
  step_zv(all_predictors())%&gt;%
  step_corr(all_predictors())

prep(friends_recipe)%&gt;%juice()</code></pre>
<pre><code>## # A tibble: 138 x 30
##    season episode `#ALL#` `Chandler Bing` `Joey Tribbiani` `Monica Geller`
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
##  1  -1.60  -1.57    3.80            0.326            0.298           3.09 
##  2  -1.60  -1.43    0.438          -1.62            -2.00           -0.628
##  3  -1.60  -1.16    1.56           -0.266           -0.812           0.940
##  4  -1.60  -0.619   0.998           0.157           -1.77           -0.133
##  5  -1.60  -0.483  -0.122          -0.604           -0.220           1.02 
##  6  -1.60  -0.347   2.12           -0.350           -1.18           -1.04 
##  7  -1.60  -0.211   0.998           0.580           -0.220           0.445
##  8  -1.60   0.196  -0.681           0.411           -1.03           -1.21 
##  9  -1.60   0.467  -0.122           1.34            -0.664          -1.54 
## 10  -1.60   0.603   0.438          -1.28            -0.664           1.68 
## # … with 128 more rows, and 24 more variables: `Phoebe Buffay` &lt;dbl&gt;, `Rachel
## #   Green` &lt;dbl&gt;, `Ross Geller` &lt;dbl&gt;, `Carol Willick` &lt;dbl&gt;, `Judy
## #   Geller` &lt;dbl&gt;, `Janice Litman Goralnik` &lt;dbl&gt;, `Frank Buffay Jr.` &lt;dbl&gt;,
## #   `Richard Burke` &lt;dbl&gt;, `Jack Geller` &lt;dbl&gt;, `Emily Waltham` &lt;dbl&gt;, `Mike
## #   Hannigan` &lt;dbl&gt;, `Charlie Wheeler` &lt;dbl&gt;, us_views_millions &lt;dbl&gt;, `James
## #   Burrows` &lt;dbl&gt;, ` Marta Kauffman` &lt;dbl&gt;, `Peter Bonerz` &lt;dbl&gt;, `Michael
## #   Lembeck` &lt;dbl&gt;, `Gail Mancuso` &lt;dbl&gt;, `Kevin S. Bright` &lt;dbl&gt;, `Gary
## #   Halvorson` &lt;dbl&gt;, ` Ted Cohen` &lt;dbl&gt;, ` Ellen Plummer` &lt;dbl&gt;, title &lt;fct&gt;,
## #   imdb_rating &lt;dbl&gt;</code></pre>
<pre class="r"><code>library(vip)</code></pre>
<pre><code>## Warning: package &#39;vip&#39; was built under R version 4.0.2</code></pre>
<pre><code>## 
## Attaching package: &#39;vip&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:utils&#39;:
## 
##     vi</code></pre>
<pre class="r"><code>set.seed(234)
friends_lasso&lt;-linear_reg(penalty = 0.001, mixture=1)%&gt;%set_engine(&quot;glmnet&quot;)

workflow()%&gt;%add_recipe(friends_recipe)%&gt;%add_model(friends_lasso)%&gt;%
  fit(data = friends_train)%&gt;%pull_workflow_fit()%&gt;%tidy()%&gt;%arrange(desc(estimate))</code></pre>
<pre><code>## Warning: package &#39;glmnet&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 4.0-2</code></pre>
<pre><code>## # A tibble: 29 x 3
##    term                   estimate penalty
##    &lt;chr&gt;                     &lt;dbl&gt;   &lt;dbl&gt;
##  1 (Intercept)              8.50     0.001
##  2 us_views_millions        0.202    0.001
##  3 Monica Geller            0.109    0.001
##  4 Frank Buffay Jr.         0.0804   0.001
##  5 season                   0.0711   0.001
##  6 Ross Geller              0.0551   0.001
##  7 Chandler Bing            0.0505   0.001
##  8 Richard Burke            0.0319   0.001
##  9 #ALL#                    0.0291   0.001
## 10 Janice Litman Goralnik   0.0205   0.001
## # … with 19 more rows</code></pre>
<pre class="r"><code>set.seed(2020)
tune_model &lt;-linear_reg(penalty = tune(), mixture=1)%&gt;%
  set_engine(&quot;glmnet&quot;)

lambda &lt;- grid_regular(penalty(),levels = 50)

tuned_lasso&lt;-tune_grid(workflow()%&gt;%add_recipe(friends_recipe)%&gt;%add_model(tune_model),
          resamples = friends_boot,
          grid = lambda)</code></pre>
<pre><code>## ! Bootstrap01: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap02: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap03: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap04: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap05: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap06: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap07: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap08: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap09: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap10: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap11: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap12: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap13: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap14: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap15: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap16: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap17: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap18: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap19: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap20: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap21: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap22: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap23: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap24: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Bootstrap25: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre class="r"><code>tuned_lasso%&gt;%collect_metrics()%&gt;%
  ggplot(aes(x = penalty, y = mean, color = .metric))+
  geom_point()+geom_path()+facet_wrap(~.metric,scales = &quot;free&quot;,ncol = 1)+
  scale_x_log10()</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>best_penalty&lt;-tuned_lasso%&gt;%select_best(&quot;rmse&quot;)

final_workflow&lt;-finalize_workflow(workflow()%&gt;%
                                    add_recipe(friends_recipe)%&gt;%
                                    add_model(tune_model), 
                                  best_penalty)</code></pre>
<pre class="r"><code>set.seed(4321)
final_workflow%&gt;%fit(data = friends_train)%&gt;%
  pull_workflow_fit()%&gt;%
  vi(lamda = best_penalty$penalty)%&gt;%
  mutate(Importance = abs(Importance))%&gt;%
  ggplot(aes(x = Importance, y = reorder(Variable, Importance), fill = Sign))+
  geom_col()</code></pre>
<p><img src="/post/2020-09-16-data-analysis-on-friends_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
